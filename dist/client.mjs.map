{"version":3,"sources":["src/client.js","src/models/Product.js","src/models/Cart.js","src/models/Category.js","src/utils/is.js","src/config.js","src/models/Store.js","src/utils/strings.js","src/utils/form-data.js","src/utils/objects.js","src/utils/fetch.js","src/utils/http.js","src/utils/arrays.js","src/utils/parseUrl.js","src/utils/storage.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","_defineProperty","value","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","Array","isArray","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","err","client","ProductUrls","a","urls","this","assign","ProductImage","image","ProductMedia","media","cover","ProductFile","file","ProductVariant","variant","selected","arguments","id","ProductVariantAttributeOption","label","ProductVariantAttribute","options","keys","map","Product","product","variantId","is","object","store","array","images","files","has_variants","empty","variants","has_variant_attributes","variant_attributes","attribute","get","find","CartItem","item","cartId","variant_id","Cart","cart","active","items","from","addToCart","index","removeFromCart","Category","category","getConstructor","input","instanceOf","isObject","isNumber","Number","isNaN","isString","String","isBoolean","Boolean","isFunction","Function","isNullOrUndefined","isObjectId","test","isCurrencyCode","isProduct","isCart","isCategory","isEmpty","isUrl","strict","window","URL","string","concat","hostname","e","number","boolean","function","nullOrUndefined","objectId","currencyCode","url","getBase","env","config","products","keyword","page","categories","createCart","getCart","checkCarts","ids","updateCartItemQuantity","Store","replaceAll","replace","RegExp","toString","toTitleCase","text","charAt","toUpperCase","substr","toLowerCase","toPascalCase","buildFormData","formKey","source","form","namespace","data","FormData","forEach","File","append","extend","b","sources","d","shift","includes","apply","parseJSON","Promise","resolve","reject","JSON","parse","error","defaults","type","body","responseType","fetch","c","xhr","XMLHttpRequest","Error","request","fail","status","addEventListener","response","then","json","success","errors","catch","open","send","queue","http","remove","post","dedupe","filter","indexOf","parseUrl","storage","Map","getKey","parsed","host","pathname","Storage","root","carts","stores","ttl","schema","Date","getTime","purge","supported","stored","localStorage","getItem","merge","set","setItem","stringify","removeItem","now","currency","getCarts","s","existing","Client","getStore","cached","setStore","getStoreId","p","discount","setCart","currentCart","isCurrency","getCartId","activeId","getActiveCart","validate","join","entries","setCarts","values","setActiveCart","currencies","quantity"],"mappings":"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","file":"client.mjs","sourcesContent":["import config from './config';\nimport { Cart, CartItem } from './models/Cart';\nimport Category from './models/Category';\nimport Product from './models/Product';\nimport Store from './models/Store';\nimport http from './utils/http';\nimport is from './utils/is';\nimport Storage from './utils/storage';\n\nclass Client {\n    constructor(props) {\n        const { env, store } = props;\n\n        this.env = !is.empty(env) ? env : '';\n        this.store = store;\n\n        if (!is.url(store) && !is.number(store)) {\n            throw Error('A store ID or URL is required to create a client');\n        }\n\n        this.storage = new Storage();\n    }\n\n    /**\n     * Get the store ID only\n     */\n    getStoreId() {\n        return new Promise((resolve, reject) => {\n            if (is.number(this.store)) {\n                resolve(this.store);\n                return;\n            }\n\n            if (this.store instanceof Store) {\n                resolve(this.store.id);\n                return;\n            }\n\n            // URL is required\n            if (!is.url(this.store)) {\n                reject(new Error('Url is required for user lookup'));\n            }\n\n            // Get by URL\n            this.getStore()\n                .then(store => {\n                    resolve(store.id);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get the Store for current instance\n     */\n    getStore() {\n        return new Promise((resolve, reject) => {\n            // Try from cache by ID or URL\n            if (is.number(this.store) || is.url(this.store)) {\n                const cached = this.storage.getStore(this.store);\n\n                // Return cached if we have it\n                if (cached !== null && cached instanceof Store) {\n                    resolve(cached);\n                    return;\n                }\n            }\n\n            // If already fetched\n            if (this.store instanceof Store) {\n                resolve(this.store);\n                return;\n            }\n\n            // Fetch from remote by ID or URL\n            const url = config.urls.store(this.env, this.store);\n\n            http.get(url)\n                .then(store => {\n                    this.setStore(store);\n                    resolve(this.store);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Set the store details\n     * @param {object} store\n     */\n    setStore(store) {\n        if (!is.object(store)) {\n            return;\n        }\n\n        // Store reference to lookup URL\n        const url = is.url(this.store) ? this.store : null;\n\n        // Map to Store\n        this.store = new Store(store);\n\n        // Add to storage for cache\n        this.storage.setStore(this.store, url);\n    }\n\n    /**\n     * Get product data\n     * @param {String} url - Short or full URL for a product\n     */\n    getProduct(url) {\n        return new Promise((resolve, reject) => {\n            http.get(config.urls.product(this.env, url))\n                .then(json => {\n                    if (!(this.store instanceof Store)) {\n                        this.setStore(json.store);\n                    }\n\n                    resolve(new Product(this, json));\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get all products\n     */\n    getProducts(keyword = '', category = '', page = 1) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    http.get(\n                        config.urls.products(\n                            this.env,\n                            id,\n                            !is.empty(keyword) ? keyword : '',\n                            is.objectId(category) ? category : '',\n                            !is.number(page) || page < 1 ? 1 : page,\n                        ),\n                    )\n                        .then(json => {\n                            resolve(\n                                Object.assign({}, json, {\n                                    products: json.products.map(p => new Product(this, p)),\n                                }),\n                            );\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get all categories\n     */\n    getCategories() {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    http.get(config.urls.categories(this.env, id))\n                        .then(json => {\n                            resolve(\n                                Object.assign({}, json, {\n                                    categories: json.categories.map(c => new Category(c)),\n                                }),\n                            );\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Create a new shopping cart\n     * @param {String} currency - ISO currency code\n     * @param {String} discount - Discount code\n     */\n    createCart(currency, discount) {\n        return new Promise((resolve, reject) => {\n            if (is.empty(currency)) {\n                reject(new Error('currency is required'));\n                return;\n            }\n\n            this.getStoreId()\n                .then(id => {\n                    const currencyCode = currency.toUpperCase();\n\n                    http.post(config.urls.createCart(this.env, id), {\n                        currency: currencyCode,\n                        discount: !is.empty(discount) ? discount : null,\n                    })\n                        .then(json => {\n                            const cart = new Cart(this, json);\n\n                            // Store reference to cart id for later\n                            this.storage.setCart(id, currencyCode, cart);\n\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get a shopping cart or create one if needed\n     * @param {String} currency - The shopping cart ISO currency code\n     */\n    getCartId(currency) {\n        return new Promise((resolve, reject) => {\n            if (!is.currencyCode(currency)) {\n                reject(new Error('A valid currency code is required'));\n                return;\n            }\n\n            this.getStoreId()\n                .then(id => {\n                    const currencyCode = currency.toUpperCase();\n                    const currentCart = this.storage.getCart(id, currencyCode);\n\n                    // Create cart if it doesn't exist\n                    if (is.empty(currentCart)) {\n                        this.createCart(currencyCode)\n                            .then(cart => resolve(cart.id))\n                            .catch(reject);\n                    } else {\n                        resolve(currentCart.id);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get a shopping cart\n     * @param {String} input - The shopping cart ISO currency code or cart ID\n     */\n    getCart(input) {\n        return new Promise((resolve, reject) => {\n            const isCurrency = is.currencyCode(input);\n            const isObjectId = is.objectId(input);\n\n            if (!isCurrency && !isObjectId) {\n                reject(new Error('A valid currency code or cart id are required'));\n                return;\n            }\n\n            if (isCurrency) {\n                const currencyCode = input.toUpperCase();\n\n                this.getCartId(currencyCode)\n                    .then(id => {\n                        if (is.empty(id)) {\n                            reject(new Error(`Could not find matching cart for currency code '${currencyCode}'`));\n                            return;\n                        }\n\n                        this.getCart(id)\n                            .then(cart => {\n                                // Update store\n                                this.setStore(cart.store);\n\n                                resolve(cart);\n                            })\n                            .catch(reject);\n                    })\n                    .catch(reject);\n            } else {\n                http.get(config.urls.getCart(this.env, input))\n                    .then(json => {\n                        const activeId = this.getActiveCart();\n                        const cart = new Cart(this, json, json.id === activeId);\n\n                        // Update store\n                        this.setStore(cart.store);\n\n                        resolve(cart);\n                    })\n                    .catch(reject);\n            }\n        });\n    }\n\n    /**\n     * Get all current carts\n     */\n    getCarts(validate = true) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    const carts = this.storage.getCarts(id);\n\n                    if (is.empty(carts)) {\n                        resolve(null);\n                        return;\n                    }\n\n                    // Check the carts still exist in the server\n                    if (validate) {\n                        const ids = Object.keys(carts).map(currency => carts[currency].id);\n\n                        http.get(config.urls.checkCarts(this.env, ids.join(',')))\n                            .then(json => {\n                                // Remove non existant carts\n                                Object.entries(json).forEach(([cartId, exists]) => {\n                                    if (!exists) {\n                                        const currency = Object.keys(carts).find(c => carts[c].id === cartId);\n                                        delete carts[currency];\n                                    }\n                                });\n\n                                // Store again\n                                this.storage.setCarts(id, carts);\n\n                                // Set active\n                                if (!Object.values(carts).find(cart => cart.active)) {\n                                    this.setActiveCart()\n                                        .then(resolve)\n                                        .catch(reject);\n                                } else {\n                                    resolve(carts);\n                                }\n                            })\n                            .catch(reject);\n                    } else {\n                        resolve(carts);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Set the active cart based on currency\n     * @param {String} input - The shopping cart ISO currency code or cart ID\n     */\n    setActiveCart(input = null) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    this.getCarts(false).then(data => {\n                        const carts = data;\n\n                        // No carts\n                        if (is.empty(carts)) {\n                            resolve(null);\n                            return;\n                        }\n\n                        // Currency code was passed...\n                        if (is.currencyCode(input)) {\n                            const currencyCode = input.toUpperCase();\n                            const currencies = Object.keys(carts);\n\n                            // Bail if not included\n                            if (!currencies.includes(currencyCode)) {\n                                reject(new Error(`No carts for ${currencyCode}`));\n                                return;\n                            }\n\n                            // Set active\n                            currencies.forEach(currency => {\n                                carts[currency].active = currency === currencyCode;\n                            });\n                        } else {\n                            // Set to id if specified, otherwise first\n                            const cartId = is.objectId(input) ? input : carts[Object.keys(carts)[0]].id;\n\n                            // Set active\n                            Object.keys(carts).forEach(currency => {\n                                const cart = carts[currency];\n                                cart.active = cart.id === cartId;\n                            });\n                        }\n\n                        // Store again\n                        this.storage.setCarts(id, carts);\n\n                        resolve(carts);\n                    });\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get the current active cart\n     */\n    getActiveCart(fetch = false) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    const carts = this.storage.getCarts(id);\n\n                    if (!Object.keys(carts).length) {\n                        resolve(null);\n                        return;\n                    }\n\n                    const active = Object.values(carts).find(cart => cart.active);\n\n                    if (!active) {\n                        resolve(null);\n                        return;\n                    }\n\n                    if (!fetch) {\n                        resolve(active.id);\n                        return;\n                    }\n\n                    this.getCart(active.id)\n                        .then(resolve)\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Add a product to a cart\n     * @param {String} id - The cart ID\n     * @param {Object} product - The product details\n     */\n    addToCart(id, product) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(product)) {\n                reject(new Error('A valid product is required'));\n                return;\n            }\n\n            http.post(config.urls.addToCart(this.env, id), product)\n                .then(json => {\n                    const cart = new Cart(this, json, true);\n\n                    // Update store\n                    this.setStore(cart.store);\n\n                    // Set the active cart\n                    this.setActiveCart(cart.id)\n                        .then(() => {\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Update an items quantity in the shopping cart\n     * @param {String} id - The shopping cart ID\n     * @param {String} index - The shopping cart item quid\n     * @param {Number} quantity - Desired quantity\n     */\n    updateCartItemQuantity(id, index, quantity = 1) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(index)) {\n                reject(new Error('A valid index is required'));\n                return;\n            }\n\n            http.post(config.urls.updateCartItemQuantity(this.env, id), { index, quantity })\n                .then(json => {\n                    const cart = new Cart(this, json, true);\n\n                    // Update store\n                    this.setStore(cart.store);\n\n                    // Set the active cart\n                    this.setActiveCart(cart.id)\n                        .then(() => {\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Remove a product from a cart\n     * @param {String} id - The shopping cart id\n     * @param {String} index - The shopping cart item guid\n     */\n    removeFromCart(id, index) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(index)) {\n                reject(new Error('A valid index is required'));\n                return;\n            }\n\n            http.post(config.urls.removeFromCart(this.env, id), { index })\n                .then(json => {\n                    // If there's actually a cart left, map it\n                    if (!is.empty(json)) {\n                        const cart = new Cart(this, json, true);\n\n                        // Set the active cart\n                        this.setActiveCart(cart.id)\n                            .then(() => {\n                                resolve(cart);\n                            })\n                            .catch(reject);\n                    } else {\n                        // Otherwise, update carts (as one removed)\n                        this.getCarts()\n                            .then(() => resolve(null))\n                            .catch(reject);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n}\n\nexport { Product, Category, Cart, CartItem, Store };\n\nexport default Client;\n","import is from '../utils/is';\n\nlet client = null;\n\nclass ProductUrls {\n    constructor(urls) {\n        // Take all properties by default\n        Object.assign(this, urls);\n    }\n}\n\nclass ProductImage {\n    constructor(image) {\n        // Take all properties by default\n        Object.assign(this, image);\n    }\n}\n\nclass ProductMedia {\n    constructor(media) {\n        // Take all properties by default\n        Object.assign(this, media);\n\n        // Map cover image\n        this.cover = new ProductImage(media.cover);\n    }\n}\n\nclass ProductFile {\n    constructor(file) {\n        // Take all properties by default\n        Object.assign(this, file);\n    }\n}\n\nclass ProductVariant {\n    constructor(variant, selected = '') {\n        // Take all properties by default\n        Object.assign(this, variant);\n\n        this.selected = variant.id === selected;\n    }\n}\n\nclass ProductVariantAttributeOption {\n    constructor(id, label) {\n        this.id = id;\n        this.label = label;\n    }\n}\n\nclass ProductVariantAttribute {\n    constructor(variant) {\n        // Take all properties by default\n        Object.assign(this, variant);\n\n        // Map options\n        this.options = Object.keys(variant.options).map(\n            id => new ProductVariantAttributeOption(id, variant.options[id]),\n        );\n    }\n}\n\nclass Product {\n    constructor(instance, product, variantId = '') {\n        if (!is.object(product)) {\n            return;\n        }\n\n        client = instance;\n\n        // Take all properties by default\n        Object.assign(this, product);\n\n        // Map store\n        this.store = client.store;\n\n        // Product URLs\n        if (is.object(product.urls)) {\n            this.urls = new ProductUrls(product.urls);\n        }\n\n        // Media (Video, YouTube, Vimeo, Audio)\n        if (is.object(product.media)) {\n            this.media = new ProductMedia(product.media);\n        }\n\n        // Images\n        if (is.array(product.images)) {\n            this.images = product.images.map(image => new ProductImage(image));\n        }\n\n        // Files for digital products\n        if (is.array(product.files)) {\n            this.files = product.files.map(file => new ProductFile(file));\n        }\n\n        // Variants\n        if (product.has_variants) {\n            const selected = !is.empty(variantId) ? variantId : product.variants[0].id;\n            this.variants = product.variants.map(variant => new ProductVariant(variant, selected));\n        }\n        if (product.has_variant_attributes) {\n            this.variant_attributes = product.variant_attributes.map(\n                attribute => new ProductVariantAttribute(attribute),\n            );\n        }\n    }\n\n    // eslint-disable-next-line camelcase\n    get selected_variant() {\n        if (is.empty(this.variants)) {\n            return null;\n        }\n\n        return this.variants.find(variant => variant.selected);\n    }\n}\n\nexport default Product;\n","import Product from './Product';\n\nlet client = null;\n\nexport class CartItem {\n    constructor(item, cartId) {\n        this.cartId = cartId;\n\n        // Take all properties by default\n        Object.assign(this, item);\n\n        // Map product\n        this.product = new Product(client, item.product, item.variant_id);\n    }\n}\n\nexport class Cart {\n    constructor(instance, cart, active = false) {\n        if (cart === null) {\n            return;\n        }\n\n        client = instance;\n\n        // Take all properties by default\n        Object.assign(this, cart);\n\n        // Map store\n        this.store = client.store;\n\n        // Set active state\n        this.active = active;\n\n        // Map items\n        this.items = Array.from(cart.items).map(item => new CartItem(item, cart.id));\n    }\n\n    /**\n     * Add a product to this cart\n     * @param {object} product - The product details\n     */\n    add(product) {\n        return client.addToCart(this.id, product);\n    }\n\n    /**\n     * Remove a product from this cart\n     * @param {string} index\n     */\n    remove(index) {\n        return client.removeFromCart(this.id, index);\n    }\n}\n\nexport default Cart;\n","import is from '../utils/is';\n\nclass Category {\n    constructor(category = null) {\n        if (!is.object(category)) {\n            return;\n        }\n\n        // Take all properties by default\n        Object.assign(this, category);\n    }\n}\n\nexport default Category;\n","// ==========================================================================\n// Type checking\n// ==========================================================================\n\nimport { Cart } from '../models/Cart';\nimport Category from '../models/Category';\nimport Product from '../models/Product';\n\nconst getConstructor = input => (input !== null && typeof input !== 'undefined' ? input.constructor : null);\nconst instanceOf = (input, constructor) => Boolean(input && constructor && input instanceof constructor);\nconst isArray = input => Array.isArray(input);\nconst isObject = input => getConstructor(input) === Object;\nconst isNumber = input => getConstructor(input) === Number && !Number.isNaN(input);\nconst isString = input => getConstructor(input) === String;\nconst isBoolean = input => getConstructor(input) === Boolean;\nconst isFunction = input => getConstructor(input) === Function;\nconst isNullOrUndefined = input => input === null || typeof input === 'undefined';\nconst isObjectId = input => isString(input) && /^[a-f\\d]{24}$/i.test(input);\nconst isCurrencyCode = input => isString(input) && /^[A-z]{3}$/.test(input);\nconst isProduct = input => getConstructor(input) === Product && Object.keys(input).length > 0;\nconst isCart = input => getConstructor(input) === Cart && Object.keys(input).length > 0;\nconst isCategory = input => getConstructor(input) === Category && Object.keys(input).length > 0;\n\nconst isEmpty = input =>\n    isNullOrUndefined(input) ||\n    ((isString(input) || isArray(input)) && !input.length) ||\n    (isObject(input) && !Object.keys(input).length);\n\nconst isUrl = (input, strict = false) => {\n    // Accept a URL object\n    if (instanceOf(input, window.URL)) {\n        return true;\n    }\n\n    // Add the protocol if required\n    let string = input;\n    if (!strict && !/^https?:\\/\\/*/.test(input)) {\n        string = `http://${input}`;\n    }\n\n    try {\n        return !isEmpty(new URL(string).hostname);\n    } catch (e) {\n        return false;\n    }\n};\n\nconst is = {\n    array: isArray,\n    object: isObject,\n    number: isNumber,\n    string: isString,\n    boolean: isBoolean,\n    function: isFunction,\n    nullOrUndefined: isNullOrUndefined,\n    objectId: isObjectId,\n    currencyCode: isCurrencyCode,\n    product: isProduct,\n    cart: isCart,\n    category: isCategory,\n    url: isUrl,\n    empty: isEmpty,\n};\n\nexport default is;\n","import is from './utils/is';\n\nconst getBase = env => `https://${is.empty(env) ? 'sdk.selz.com' : `${env}/sdk`}/`;\n\nconst config = {\n    urls: {\n        /**\n         * Get URL for product data by URL\n         * @param {String} env - Environment (for internal use)\n         * @param {String} url - Short or full URL for a product\n         */\n        product(env, url = '') {\n            return `${getBase(env)}products/find?url=${url}`;\n        },\n\n        /**\n         * Get URL for all products by store ID\n         * @param {String} env - Environment (for internal use)\n         * @param {Number|String} id - The store ID\n         * @param {String} keyword - Search keyword\n         * @param {ObjectId|String} category - Category ID or relative path\n         * @param {Number} page - Page to fetch\n         */\n        products(env, id, keyword = '', category = '', page = 1) {\n            return `${getBase(env)}products/all/${id}?q=${keyword}&c=${category}&p=${page}`;\n        },\n\n        /**\n         * Get all categories for a given store ID\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - The store ID\n         */\n        categories(env, id) {\n            return `${getBase(env)}categories/${id}`;\n        },\n\n        /**\n         * Get URL for finding a store by URL or ID\n         * @param {String} env - Environment (for internal use)\n         * @param {Number|String} input - The ID or URL to lookup\n         */\n        store(env, input = null) {\n            if (is.number(input)) {\n                return `${getBase(env)}store/find/${input}`;\n            }\n\n            return `${getBase(env)}store/find?url=${input}`;\n        },\n\n        /**\n         * Create a new cart\n         * @param {String} env - Environment (for internal use)\n         * @param {Number} id - Store ID\n         */\n        createCart(env, id = '') {\n            return `${getBase(env)}cart/create/${id}`;\n        },\n\n        /**\n         * Get cart from ID\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        getCart(env, id = '') {\n            return `${getBase(env)}cart/${id}`;\n        },\n\n        /**\n         * Check carts still exist server side\n         * @param {String} env - Environment (for internal use)\n         * @param {Number} id - Cart IDs\n         */\n        checkCarts(env, ids = '') {\n            return `${getBase(env)}cart/verify?ids=${ids}`;\n        },\n\n        /**\n         * Add product to cart\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        addToCart(env, id = '') {\n            return `${getBase(env)}cart/add/${id}`;\n        },\n\n        /**\n         * Update a cart item quantity\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        updateCartItemQuantity(env, id = '') {\n            return `${getBase(env)}cart/updateitemquantity/${id}`;\n        },\n\n        /**\n         * Remove product from cart\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        removeFromCart(env, id = '') {\n            return `${getBase(env)}cart/remove/${id}`;\n        },\n    },\n};\n\nexport default config;\n","import is from '../utils/is';\n\nclass Store {\n    constructor(store = null) {\n        if (!is.object(store)) {\n            return;\n        }\n\n        // Take all properties by default\n        Object.assign(this, store);\n    }\n}\n\nexport default Store;\n","// ==========================================================================\n// String utils\n// ==========================================================================\n\n// Replace all occurances of a string in a string\nexport function replaceAll(input = '', find = '', replace = '') {\n    return input.replace(\n        new RegExp(find.toString().replace(/([.*+?^=!:${}()|[\\]/\\\\])/g, '\\\\$1'), 'g'),\n        replace.toString(),\n    );\n}\n\n// Convert to title case\nexport function toTitleCase(input = '') {\n    return input.toString().replace(/\\w\\S*/g, text => text.charAt(0).toUpperCase() + text.substr(1).toLowerCase());\n}\n\n// Convert string to pascalCase\nexport function toPascalCase(input = '') {\n    let string = input.toString();\n\n    // Convert kebab case\n    string = replaceAll(string, '-', ' ');\n\n    // Convert snake case\n    string = replaceAll(string, '_', ' ');\n\n    // Convert to title case\n    string = toTitleCase(string);\n\n    // Convert to pascal case\n    return replaceAll(string, ' ', '');\n}\n\n// Convert string to pascalCase\nexport function toCamelCase(input = '') {\n    let string = input.toString();\n\n    // Convert to pascal case\n    string = toPascalCase(string);\n\n    // Convert first character to lowercase\n    return string.charAt(0).toLowerCase() + string.slice(1);\n}\n","// ==========================================================================\n// Form Data utils\n// ==========================================================================\n\nimport is from './is';\nimport { toPascalCase } from './strings';\n\n/**\n * Convert an Object to FormData\n * @param {Object} source - source Object\n * @param {FormData} form - existing FormData object\n * @param {String} namespace - namespace for FormData\n */\nconst buildFormData = (source = {}, form, namespace) => {\n    const data = form || new FormData();\n    let formKey;\n\n    // Source must be an object\n    if (!is.object(source)) {\n        return data;\n    }\n\n    // Loop through the object to convert\n    Object.keys(source).forEach(key => {\n        if (namespace) {\n            formKey = `${namespace}[${key}]`;\n        } else {\n            formKey = key;\n        }\n\n        // If the property is an object, but not a File, use recursivity\n        if (typeof source[key] === 'object' && !(source[key] instanceof File)) {\n            buildFormData(source[key], data, key);\n        } else {\n            data.append(toPascalCase(formKey), source[key]);\n        }\n    });\n\n    return data;\n};\n\nexport default buildFormData;\n","// ==========================================================================\n// Extend objects\n// ==========================================================================\n\nimport is from './is';\n\n/**\n * Deep extend destination object with N more objects\n * @param {Object} target\n * @param {...Object} sources\n */\nexport function extend(target = {}, ...sources) {\n    if (!sources.length) {\n        return target;\n    }\n\n    const source = sources.shift();\n\n    if (!is.object(source)) {\n        return target;\n    }\n\n    Object.keys(source).forEach(key => {\n        if (is.object(source[key])) {\n            if (!Object.keys(target).includes(key)) {\n                Object.assign(target, { [key]: {} });\n            }\n\n            extend(target[key], source[key]);\n        } else {\n            Object.assign(target, { [key]: source[key] });\n        }\n    });\n\n    return extend(target, ...sources);\n}\n\n/**\n * Safer JSON parsing\n * @param {Object} data\n */\nexport function parseJSON(data = {}) {\n    return new Promise((resolve, reject) => {\n        try {\n            resolve(JSON.parse(data));\n        } catch (error) {\n            reject(error);\n        }\n    });\n}\n","// ==========================================================================\n// Fetch\n// ==========================================================================\n\nimport buildFormData from './form-data';\nimport { extend, parseJSON } from './objects';\n\nconst defaults = {\n    type: 'GET',\n    body: {},\n    responseType: 'json',\n};\n\n/**\n * Custom immitation fetch using XHR\n * @param {string} url - The URL of the endpoint\n * @param {object} options - Object of options for the request\n */\nexport default function(url, options = {}) {\n    const { type, body, responseType } = extend({}, defaults, options);\n\n    return new Promise((resolve, reject) => {\n        try {\n            const xhr = new XMLHttpRequest();\n\n            // Check for CORS support\n            if (!('withCredentials' in xhr)) {\n                const error = new Error('No CORS support');\n                error.request = xhr;\n                throw error;\n            }\n\n            // Handle failures\n            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/status\n            const fail = () => {\n                const error = new Error(xhr.status);\n                error.request = xhr;\n                reject(error);\n            };\n\n            // Successfully made the request\n            xhr.addEventListener('load', () => {\n                const { response } = xhr;\n\n                // Something went wrong either with the request or server\n                if (xhr.status >= 400) {\n                    fail();\n                    return;\n                }\n\n                // Parse JSON responses\n                if (responseType === 'json') {\n                    parseJSON(response)\n                        .then(json => {\n                            if (json.success) {\n                                resolve(json.data);\n                            } else {\n                                const error = new Error('Request failed');\n                                error.errors = json.errors;\n                                reject(error);\n                            }\n                        })\n                        .catch(reject);\n                } else {\n                    resolve(response);\n                }\n            });\n\n            // Request failed\n            xhr.addEventListener('error', fail);\n\n            // Start the request\n            xhr.open(type, url, true);\n\n            // Set the required response type\n            // 'json' responseType is much slower, so we parse later\n            // https://github.com/arendjr/fetch-vs-xhr-perf\n            if (responseType !== 'json') {\n                xhr.responseType = responseType;\n            }\n\n            // Send data if passed\n            xhr.send(buildFormData(body));\n        } catch (error) {\n            reject(error);\n        }\n    });\n}\n","// ==========================================================================\n// Common fetch actions\n// ==========================================================================\n\nimport fetch from './fetch';\n\nconst queue = {};\n\nconst http = {\n    /**\n     * GET remote URL and parse as JSON\n     * @param {string} url - The endpoint URL\n     */\n    get(url) {\n        // Queue requests to prevent hammering\n        if (!Object.keys(queue).includes(url)) {\n            queue[url] = fetch(url);\n\n            const remove = () => {\n                delete queue[url];\n            };\n\n            // Remove from queue on completed\n            queue[url].then(remove).catch(remove);\n        }\n\n        return queue[url];\n    },\n\n    /**\n     * POST to remote URL and parse as JSON\n     * @param {string} url - The endpoint URL\n     * @param {object} data - The POST data payload\n     */\n    post(url, data = {}) {\n        const options = {\n            type: 'POST',\n            body: data,\n        };\n\n        return fetch(url, options);\n    },\n};\n\nexport default http;\n","// ==========================================================================\n// Array utils\n// ==========================================================================\n\nimport is from './is';\n\n/**\n * Remove duplicates in an array\n * @param {array} array\n */\nexport function dedupe(array) {\n    if (!is.array(array)) {\n        return array;\n    }\n\n    return array.filter((item, index) => array.indexOf(item) === index);\n}\n\n// Rounding methods for .closest()\nconst closestRounding = {\n    none: 0,\n    ceil: 1,\n    floor: 2,\n};\nexport { closestRounding };\n\n/**\n * Get the closest value in an array\n * @param {array} array\n * @param {number} value\n * @param {number} rounding\n */\nexport function closest(array, value, rounding = closestRounding.none) {\n    if (!is.array(array) || !array.length) {\n        return null;\n    }\n\n    return array.reduce((prev, curr) => {\n        if (Math.abs(curr - value) <= Math.abs(prev - value)) {\n            switch (rounding) {\n                case closestRounding.ceil:\n                    return curr >= value ? curr : prev;\n\n                case closestRounding.floor:\n                    return curr <= value ? curr : prev;\n\n                default:\n                    return curr;\n            }\n        }\n\n        return prev;\n    });\n}\n","/**\n * Parse a string to URL object\n * @param {String} url\n */\nexport default function parseUrl(url) {\n    let string = url;\n\n    // Add the protocol if required\n    if (!/^https?:\\/\\/*/.test(url)) {\n        string = `http://${url}`;\n    }\n\n    try {\n        return new URL(string);\n    } catch (e) {\n        return null;\n    }\n}\n","// ==========================================================================\n// Local storage wrapper\n// TODO: methods should return promises?\n// ==========================================================================\n\nimport Store from '../models/Store';\nimport { dedupe } from './arrays';\nimport is from './is';\nimport { extend } from './objects';\nimport parseUrl from './parseUrl';\n\nconst storage = new Map();\n\nconst getKey = url => {\n    if (url === null) {\n        return null;\n    }\n\n    const parsed = parseUrl(url);\n\n    if (parsed === null) {\n        return null;\n    }\n\n    return `${parsed.host}${parsed.pathname}`.replace(/\\/$/, '');\n};\n\nclass Storage {\n    constructor(config) {\n        this.config = Object.assign(\n            {\n                keys: {\n                    root: 'selz-js-sdk',\n                    carts: 'carts',\n                    stores: 'stores',\n                },\n                ttl: 3600, // 1 hour\n                schema: new Date('2018-07-02').getTime(), // Schema version (allowing us to change data schema and invalidate storage)\n            },\n            config,\n        );\n\n        this.purge();\n    }\n\n    // Check for actual support (see if we can use it)\n    static get supported() {\n        if (!window.localStorage) {\n            return false;\n        }\n\n        const key = '___test';\n\n        // Try to use it\n        try {\n            window.localStorage.setItem(key, key);\n            window.localStorage.removeItem(key);\n            return true;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    get(key) {\n        let data = storage.get(this.config.keys.root);\n\n        // Grab from real storage if we can or use faux-storage\n        if (Storage.supported) {\n            const stored = window.localStorage.getItem(this.config.keys.root);\n\n            if (!is.empty(stored)) {\n                data = JSON.parse(stored);\n            }\n        }\n\n        if (is.empty(data)) {\n            return null;\n        }\n\n        if (!is.empty(key)) {\n            return Object.keys(data).includes(key) ? data[key] : null;\n        }\n\n        return data;\n    }\n\n    set(key, value, merge = false) {\n        // Get current storage\n        const data = this.get() || {};\n\n        // Extend with the new data\n        if (merge && Object.keys(data).includes(key)) {\n            data[key] = extend(data[key], value);\n        } else {\n            data[key] = value;\n        }\n\n        // Set in faux-storage\n        storage.set(this.config.keys.root, data);\n\n        // Bail if no real support\n        if (!Storage.supported) {\n            return;\n        }\n\n        // Set schema version\n        data.schema = this.config.schema;\n\n        // Update storage\n        try {\n            window.localStorage.setItem(this.config.keys.root, JSON.stringify(data));\n        } catch (e) {\n            // Do nothing\n        }\n    }\n\n    // Clean up stale storage\n    purge() {\n        // Check schema\n        const data = this.get();\n\n        // Nothing to purge\n        if (is.empty(data)) {\n            return;\n        }\n\n        // If schema does not match, kill it\n        if (Number(data.schema) !== this.config.schema) {\n            window.localStorage.removeItem(this.config.keys.root);\n            return;\n        }\n\n        // Get current list of stores\n        const stores = this.get(this.config.keys.stores) || [];\n\n        // Nothing to cleanup\n        if (is.empty(stores)) {\n            return;\n        }\n\n        // Check TTL is valid\n        this.set(\n            this.config.keys.stores,\n            stores.filter(store => {\n                const ttl = Number(store.ttl);\n                return ttl > 0 && ttl > Date.now();\n            }),\n        );\n    }\n\n    getCarts(store) {\n        const data = this.get(this.config.keys.carts) || {};\n\n        // If no carts\n        if (is.empty(data)) {\n            return null;\n        }\n\n        // Get all carts\n        if (!is.number(store)) {\n            return data;\n        }\n\n        // Store not found\n        if (!Object.keys(data).includes(store.toString())) {\n            return null;\n        }\n\n        // Get all for a store\n        return data[store.toString()];\n    }\n\n    getCart(store, currency) {\n        const carts = this.getCarts(store);\n\n        // No carts\n        if (is.empty(carts)) {\n            return null;\n        }\n\n        // Get all for a store\n        if (!is.string(currency)) {\n            return carts;\n        }\n\n        // Currency not found\n        if (!Object.keys(carts).includes(currency.toUpperCase())) {\n            return null;\n        }\n\n        return carts[currency.toUpperCase()];\n    }\n\n    setCart(store, currency, cart) {\n        this.set(\n            this.config.keys.carts,\n            {\n                [store]: {\n                    [currency.toUpperCase()]: {\n                        id: cart.id,\n                        active: cart.active,\n                    },\n                },\n            },\n            true,\n        );\n    }\n\n    setCarts(store, carts = {}) {\n        this.set(this.config.keys.carts, {\n            [store]: carts,\n        });\n    }\n\n    getStore(input) {\n        let store = null;\n\n        if (!is.number(input) && !is.url(input)) {\n            return null;\n        }\n\n        const stores = this.get(this.config.keys.stores) || [];\n\n        if (is.number(input)) {\n            store = stores.find(s => is.object(s.data) && s.data.id === input);\n        } else if (is.url(input)) {\n            const key = getKey(input);\n\n            // Bail if invalid URL\n            if (key === null) {\n                return null;\n            }\n\n            store = stores.find(s => is.array(s.urls) && s.urls.includes(key));\n        }\n\n        if (!is.object(store)) {\n            return null;\n        }\n\n        // Check TTL is valid\n        const ttl = Number(store.ttl);\n\n        if (ttl > 0 && ttl < Date.now()) {\n            this.purge();\n            return null;\n        }\n\n        return new Store(store.data);\n    }\n\n    setStore(data, url = null) {\n        // Strip the protocol from the lookup url\n        const key = getKey(url);\n\n        // Get current list of stores\n        const stores = this.get(this.config.keys.stores) || [];\n        let existing = null;\n\n        if (!is.empty(stores)) {\n            // Find existing store by id\n            existing = stores.find(s => s.data.id === data.id);\n        }\n\n        // Extend TTL each\n        const ttl = Date.now() + this.config.ttl;\n\n        // If we found something\n        if (is.object(existing)) {\n            // Update data and extend TTL\n            Object.assign(existing, {\n                data,\n                ttl,\n            });\n\n            if (key !== null) {\n                // Add the URL key for later lookup\n                if (!is.array(existing.urls)) {\n                    existing.urls = [key];\n                } else {\n                    existing.urls.push(key);\n                }\n\n                // Remove duplicate entries\n                const urls = dedupe(existing.urls);\n\n                // Add to existing record\n                Object.assign(existing, {\n                    urls,\n                });\n            }\n        } else {\n            const store = {\n                data,\n                ttl,\n            };\n\n            if (key !== null) {\n                Object.assign(store, {\n                    urls: [key],\n                });\n            }\n\n            stores.push(store);\n        }\n\n        this.set(this.config.keys.stores, stores);\n    }\n}\n\nexport default Storage;\n"]}