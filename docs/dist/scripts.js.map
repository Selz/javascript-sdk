{"version":3,"sources":["docs/src/scripts.js","src/utils/is.js","src/config.js","src/models/Product.js","src/models/Cart.js","src/models/Category.js","src/models/Store.js","src/utils/objects.js","src/utils/strings.js","src/utils/form-data.js","src/utils/parseUrl.js","src/utils/fetch.js","src/utils/http.js","src/utils/storage.js","src/utils/arrays.js","src/client.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","_defineProperty","value","_slicedToArray","arr","Array","isArray","_arrayWithHoles","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","err","_iterableToArrayLimit","_nonIterableRest","getConstructor","input","isObject","isString","String","isNullOrUndefined","isEmpty","keys","is","array","object","number","Number","isNaN","string","boolean","Boolean","function","Function","nullOrUndefined","objectId","test","currencyCode","url","strict","arguments","instanceOf","window","URL","concat","hostname","e","empty","getBase","env","config","product","products","id","keyword","category","page","categories","store","createCart","getCart","checkCarts","ids","addToCart","updateCartItemQuantity","removeFromCart","client","ProductUrls","a","urls","this","assign","ProductImage","image","ProductMedia","media","cover","ProductFile","file","ProductVariant","variant","selected","ProductVariantAttributeOption","label","ProductVariantAttribute","options","map","Product","variantId","images","files","hasVariants","variants","hasVariantAttributes","variantAttributes","attribute","get","find","CartItem","item","cartId","CartAddItem","productId","quantity","discountCode","buyersUnitPrice","isProduct","Cart","cart","active","items","from","index","Category","Store","extend","b","sources","d","source","shift","forEach","includes","apply","replaceAll","replace","RegExp","toString","buildFormData","formKey","form","namespace","formData","FormData","data","JSON","parse","stringify","cloneDeep","error","File","append","text","charAt","toUpperCase","substr","toLowerCase","toTitleCase","toPascalCase","parseUrl","version","defaults","type","body","responseType","fetch","c","Promise","resolve","reject","xhr","XMLHttpRequest","Error","request","fail","status","addEventListener","response","parseJSON","then","json","success","errors","catch","endpoint","searchParams","set","open","send","queue","http","remove","console","warn","storage","Map","getKey","parsed","host","pathname","Storage","root","carts","stores","ttl","schema","Date","getTime","purge","supported","stored","localStorage","getItem","merge","setItem","removeItem","filter","now","currency","getCarts","s","existing","indexOf","dedupe","Client","getStore","cached","setStore","getStoreId","p","discount","setCart","currentCart","isCurrency","isObjectId","getCartId","activeId","getActiveCart","validate","join","entries","setCarts","values","setActiveCart","currencies","cartItem","document","log","details","createElement","summary","innerHTML","appendChild","contents","pre","classList","add","output","prettyPrint","detail","updatedCart","getElementById","getProduct"],"mappings":"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","file":"scripts.js","sourcesContent":["import Client, { CartAddItem } from '../../src/client';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    const output = document.getElementById('output');\n\n    function log(label, data) {\n        const details = document.createElement('details');\n        const summary = document.createElement('summary');\n        summary.innerHTML = label;\n        details.appendChild(summary);\n\n        const contents = document.createElement('div');\n        const pre = document.createElement('pre');\n        pre.classList.add('prettyprint');\n        pre.innerHTML = JSON.stringify(data, null, 4);\n        contents.appendChild(pre);\n        details.appendChild(contents);\n\n        output.appendChild(details);\n\n        window.prettyPrint();\n    }\n\n    function fail(label, error) {\n        if (error instanceof Error) {\n            log(`${label} (error)`, {\n                error: error.toString(),\n                detail: error.errors,\n            });\n\n            return;\n        }\n\n        log(`${label} (failed)`, error);\n    }\n\n    const client = new Client({\n        store: 'local.sampotts.me',\n        env: 'local-selz.com',\n    });\n\n    // Expose\n    window.client = client;\n\n    log('Client', client);\n\n    function getCart(currency) {\n        return new Promise((resolve, reject) => {\n            if (window.cart) {\n                resolve(window.cart);\n                return;\n            }\n\n            client\n                .getCart(currency)\n                .then(cart => {\n                    log('Get cart', cart);\n\n                    window.cart = cart;\n\n                    resolve(cart);\n                })\n                .catch(error => reject(error));\n        });\n    }\n\n    function addToCart(product) {\n        getCart(product.currencyCode)\n            .then(cart => {\n                const cartItem = new CartAddItem(product);\n                cartItem.quantity = 2;\n\n                cart.add(cartItem)\n                    .then(updatedCart => {\n                        log('Add to cart', updatedCart);\n\n                        window.cart = updatedCart;\n                    })\n                    .catch(error => fail('Add to cart', error));\n            })\n            .catch(error => fail('Get cart', error));\n    }\n\n    const products = {\n        GBP: 'http://selz.co/1MaSYRU',\n        USD: 'http://selz.co/1rvbhT6',\n    };\n\n    client\n        .getProduct(products.USD)\n        .then(product => {\n            log('Product', product);\n\n            // Expose\n            window.product = product;\n\n            addToCart(product);\n        })\n        .catch(errors => fail('Product', errors));\n\n    // Listen for messages from parent\n    /* window.addEventListener('message', event => {\n        // console.warn(event.data);\n        const json = JSON.parse(event.data);\n\n        if (json.key !== 'add-to-cart') {\n            return;\n        }\n\n        addToCart(json.data);\n    }); */\n});\n","// ==========================================================================\n// Type checking\n// ==========================================================================\n\nconst getConstructor = input => (input !== null && typeof input !== 'undefined' ? input.constructor : null);\nconst instanceOf = (input, constructor) => Boolean(input && constructor && input instanceof constructor);\nconst isArray = input => Array.isArray(input);\nconst isObject = input => getConstructor(input) === Object;\nconst isNumber = input => getConstructor(input) === Number && !Number.isNaN(input);\nconst isString = input => getConstructor(input) === String;\nconst isBoolean = input => getConstructor(input) === Boolean;\nconst isFunction = input => getConstructor(input) === Function;\nconst isNullOrUndefined = input => input === null || typeof input === 'undefined';\nconst isObjectId = input => isString(input) && /^[a-f\\d]{24}$/i.test(input);\nconst isCurrencyCode = input => isString(input) && /^[A-z]{3}$/.test(input);\n\nconst isEmpty = input =>\n    isNullOrUndefined(input) ||\n    ((isString(input) || isArray(input)) && !input.length) ||\n    (isObject(input) && !Object.keys(input).length);\n\nconst isUrl = (input, strict = false) => {\n    // Accept a URL object\n    if (instanceOf(input, window.URL)) {\n        return true;\n    }\n\n    // Add the protocol if required\n    let string = input;\n    if (!strict && !/^https?:\\/\\/*/.test(input)) {\n        string = `http://${input}`;\n    }\n\n    try {\n        return !isEmpty(new URL(string).hostname);\n    } catch (e) {\n        return false;\n    }\n};\n\nconst is = {\n    array: isArray,\n    object: isObject,\n    number: isNumber,\n    string: isString,\n    boolean: isBoolean,\n    function: isFunction,\n    nullOrUndefined: isNullOrUndefined,\n    objectId: isObjectId,\n    currencyCode: isCurrencyCode,\n    url: isUrl,\n    empty: isEmpty,\n};\n\nexport default is;\n","import is from './utils/is';\n\nconst getBase = env => `https://${is.empty(env) ? 'sdk.selz.com' : `${env}/sdk`}/`;\n\nconst config = {\n    urls: {\n        /**\n         * Get URL for product data by URL\n         * @param {String} env - Environment (for internal use)\n         * @param {String} url - Short or full URL for a product\n         */\n        product(env, url = '') {\n            return `${getBase(env)}products/find?url=${url}`;\n        },\n\n        /**\n         * Get URL for all products by store ID\n         * @param {String} env - Environment (for internal use)\n         * @param {Number|String} id - The store ID\n         * @param {String} keyword - Search keyword\n         * @param {ObjectId|String} category - Category ID or relative path\n         * @param {Number} page - Page to fetch\n         */\n        products(env, id, keyword = '', category = '', page = 1) {\n            return `${getBase(env)}products/all/${id}?q=${keyword}&c=${category}&p=${page}`;\n        },\n\n        /**\n         * Get all categories for a given store ID\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - The store ID\n         */\n        categories(env, id) {\n            return `${getBase(env)}categories/${id}`;\n        },\n\n        /**\n         * Get URL for finding a store by URL or ID\n         * @param {String} env - Environment (for internal use)\n         * @param {Number|String} input - The ID or URL to lookup\n         */\n        store(env, input = null) {\n            if (is.number(input)) {\n                return `${getBase(env)}store/find/${input}`;\n            }\n\n            return `${getBase(env)}store/find?url=${input}`;\n        },\n\n        /**\n         * Create a new cart\n         * @param {String} env - Environment (for internal use)\n         * @param {Number} id - Store ID\n         */\n        createCart(env, id = '') {\n            return `${getBase(env)}cart/create/${id}`;\n        },\n\n        /**\n         * Get cart from ID\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        getCart(env, id = '') {\n            return `${getBase(env)}cart/${id}`;\n        },\n\n        /**\n         * Check carts still exist server side\n         * @param {String} env - Environment (for internal use)\n         * @param {Number} id - Cart IDs\n         */\n        checkCarts(env, ids = '') {\n            return `${getBase(env)}cart/verify?ids=${ids}`;\n        },\n\n        /**\n         * Add product to cart\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        addToCart(env, id = '') {\n            return `${getBase(env)}cart/add/${id}`;\n        },\n\n        /**\n         * Update a cart item quantity\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        updateCartItemQuantity(env, id = '') {\n            return `${getBase(env)}cart/updateitemquantity/${id}`;\n        },\n\n        /**\n         * Remove product from cart\n         * @param {String} env - Environment (for internal use)\n         * @param {String} id - Cart ID\n         */\n        removeFromCart(env, id = '') {\n            return `${getBase(env)}cart/remove/${id}`;\n        },\n    },\n};\n\nexport default config;\n","import is from '../utils/is';\n\nlet client = null;\n\nclass ProductUrls {\n    constructor(urls) {\n        // Take all properties by default\n        Object.assign(this, urls);\n    }\n}\n\nclass ProductImage {\n    constructor(image) {\n        // Take all properties by default\n        Object.assign(this, image);\n    }\n}\n\nclass ProductMedia {\n    constructor(media) {\n        // Take all properties by default\n        Object.assign(this, media);\n\n        // Map cover image\n        this.cover = new ProductImage(media.cover);\n    }\n}\n\nclass ProductFile {\n    constructor(file) {\n        // Take all properties by default\n        Object.assign(this, file);\n    }\n}\n\nclass ProductVariant {\n    constructor(variant, selected = '') {\n        // Take all properties by default\n        Object.assign(this, variant);\n\n        this.selected = variant.id === selected;\n    }\n}\n\nclass ProductVariantAttributeOption {\n    constructor(id, label) {\n        this.id = id;\n        this.label = label;\n    }\n}\n\nclass ProductVariantAttribute {\n    constructor(variant) {\n        // Take all properties by default\n        Object.assign(this, variant);\n\n        // Map options\n        this.options = Object.keys(variant.options).map(\n            id => new ProductVariantAttributeOption(id, variant.options[id]),\n        );\n    }\n}\n\nclass Product {\n    constructor(instance, product, variantId = '') {\n        if (!is.object(product)) {\n            return;\n        }\n\n        client = instance;\n\n        // Take all properties by default\n        Object.assign(this, product);\n\n        // Map store\n        this.store = client.store;\n\n        // Product URLs\n        if (is.object(product.urls)) {\n            this.urls = new ProductUrls(product.urls);\n        }\n\n        // Media (Video, YouTube, Vimeo, Audio)\n        if (is.object(product.media)) {\n            this.media = new ProductMedia(product.media);\n        }\n\n        // Images\n        if (is.array(product.images)) {\n            this.images = product.images.map(image => new ProductImage(image));\n        }\n\n        // Files for digital products\n        if (is.array(product.files)) {\n            this.files = product.files.map(file => new ProductFile(file));\n        }\n\n        // Variants\n        if (product.hasVariants) {\n            const selected = !is.empty(variantId) ? variantId : product.variants[0].id;\n            this.variants = product.variants.map(variant => new ProductVariant(variant, selected));\n        }\n        if (product.hasVariantAttributes) {\n            this.variantAttributes = product.variantAttributes.map(attribute => new ProductVariantAttribute(attribute));\n        }\n    }\n\n    get selectedVariant() {\n        if (is.empty(this.variants)) {\n            return null;\n        }\n\n        return this.variants.find(variant => variant.selected);\n    }\n}\n\nexport default Product;\n","import is from '../utils/is';\nimport Product from './Product';\n\nlet client = null;\nconst isProduct = input => !is.empty(input) && input instanceof Product;\n\nexport class CartItem {\n    constructor(item, cartId) {\n        this.cartId = cartId;\n\n        // Take all properties by default\n        Object.assign(this, item);\n\n        // Map product\n        this.product = new Product(client, item.product, item.variantId);\n    }\n}\n\nexport class CartAddItem {\n    constructor(item) {\n        this.productId = null;\n        this.variantId = null;\n        this.quantity = 1;\n        this.discountCode = null;\n        this.buyersUnitPrice = null;\n\n        if (isProduct(item) || is.object(item)) {\n            this.productId = item.id;\n            this.variantId = is.objectId(item.variant) ? item.variant : null;\n        }\n    }\n}\n\nexport class Cart {\n    constructor(instance, cart, active = false) {\n        if (cart === null) {\n            return;\n        }\n\n        client = instance;\n\n        // Take all properties by default\n        Object.assign(this, cart);\n\n        // Map store\n        this.store = client.store;\n\n        // Set active state\n        this.active = active;\n\n        // Map items\n        this.items = Array.from(cart.items).map(item => new CartItem(item, cart.id));\n    }\n\n    /**\n     * Add a product to this cart\n     * @param {Object} item - The cart item\n     */\n    add(item) {\n        return client.addToCart(this.id, item);\n    }\n\n    /**\n     * Remove a product from this cart\n     * @param {String} index\n     */\n    remove(index) {\n        return client.removeFromCart(this.id, index);\n    }\n}\n\nexport default Cart;\n","import is from '../utils/is';\n\nclass Category {\n    constructor(category = null) {\n        if (!is.object(category)) {\n            return;\n        }\n\n        // Take all properties by default\n        Object.assign(this, category);\n    }\n}\n\nexport default Category;\n","import is from '../utils/is';\n\nclass Store {\n    constructor(store = null) {\n        if (!is.object(store)) {\n            return;\n        }\n\n        // Take all properties by default\n        Object.assign(this, store);\n    }\n}\n\nexport default Store;\n","// ==========================================================================\n// Extend objects\n// ==========================================================================\n\nimport is from './is';\n\n/**\n * Clone nested objects\n * @param {object} object\n */\nexport function cloneDeep(object) {\n    return JSON.parse(JSON.stringify(object));\n}\n\n/**\n * Deep extend destination object with N more objects\n * @param {Object} target\n * @param {...Object} sources\n */\nexport function extend(target = {}, ...sources) {\n    if (!sources.length) {\n        return target;\n    }\n\n    const source = sources.shift();\n\n    if (!is.object(source)) {\n        return target;\n    }\n\n    Object.keys(source).forEach(key => {\n        if (is.object(source[key])) {\n            if (!Object.keys(target).includes(key)) {\n                Object.assign(target, { [key]: {} });\n            }\n\n            extend(target[key], source[key]);\n        } else {\n            Object.assign(target, { [key]: source[key] });\n        }\n    });\n\n    return extend(target, ...sources);\n}\n\n/**\n * Safer JSON parsing\n * @param {Object} data\n */\nexport function parseJSON(data = {}) {\n    return new Promise((resolve, reject) => {\n        try {\n            resolve(JSON.parse(data));\n        } catch (error) {\n            reject(error);\n        }\n    });\n}\n","// ==========================================================================\n// String utils\n// ==========================================================================\n\n// Replace all occurances of a string in a string\nexport function replaceAll(input = '', find = '', replace = '') {\n    return input.replace(\n        new RegExp(find.toString().replace(/([.*+?^=!:${}()|[\\]/\\\\])/g, '\\\\$1'), 'g'),\n        replace.toString(),\n    );\n}\n\n// Convert to title case\nexport function toTitleCase(input = '') {\n    return input.toString().replace(/\\w\\S*/g, text => text.charAt(0).toUpperCase() + text.substr(1).toLowerCase());\n}\n\n// Convert string to pascalCase\nexport function toPascalCase(input = '') {\n    let string = input.toString();\n\n    // Convert kebab case\n    string = replaceAll(string, '-', ' ');\n\n    // Convert snake case\n    string = replaceAll(string, '_', ' ');\n\n    // Convert to title case\n    string = toTitleCase(string);\n\n    // Convert to pascal case\n    return replaceAll(string, ' ', '');\n}\n\n// Convert string to pascalCase\nexport function toCamelCase(input = '') {\n    let string = input.toString();\n\n    // Convert to pascal case\n    string = toPascalCase(string);\n\n    // Convert first character to lowercase\n    return string.charAt(0).toLowerCase() + string.slice(1);\n}\n","// ==========================================================================\n// Form Data utils\n// ==========================================================================\n\nimport is from './is';\nimport { cloneDeep } from './objects';\nimport { toPascalCase } from './strings';\n\n/**\n * Convert an Object to FormData\n * @param {Object} source - source Object\n * @param {FormData} form - existing FormData object\n * @param {String} namespace - namespace for FormData\n */\nconst buildFormData = (source = {}, form, namespace) => {\n    const formData = form || new FormData();\n    let formKey;\n    let data = null;\n\n    // Parse as an object\n    try {\n        data = cloneDeep(source);\n    } catch (error) {\n        return formData;\n    }\n\n    // Source must be an object\n    if (!is.object(data)) {\n        return formData;\n    }\n\n    // Loop through the object to convert\n    Object.keys(data).forEach(key => {\n        if (namespace) {\n            formKey = `${namespace}[${key}]`;\n        } else {\n            formKey = key;\n        }\n\n        // If the property is an object, but not a File, use recursivity\n        if (typeof source[key] === 'object' && !(source[key] instanceof File)) {\n            buildFormData(source[key], formData, key);\n        } else {\n            formData.append(toPascalCase(formKey), source[key]);\n        }\n    });\n\n    return formData;\n};\n\nexport default buildFormData;\n","/**\n * Parse a string to URL object\n * @param {String} url\n */\nexport default function parseUrl(url) {\n    let string = url;\n\n    // Add the protocol if required\n    if (!/^https?:\\/\\/*/.test(url)) {\n        string = `http://${url}`;\n    }\n\n    try {\n        return new URL(string);\n    } catch (e) {\n        return null;\n    }\n}\n","// ==========================================================================\n// Fetch\n// ==========================================================================\n\nimport pkg from '../../package.json';\nimport buildFormData from './form-data';\nimport { extend, parseJSON } from './objects';\nimport parseUrl from './parseUrl';\n\nconst { version } = pkg;\n\nconst defaults = {\n    type: 'GET',\n    body: {},\n    responseType: 'json',\n};\n\n/**\n * Custom immitation fetch using XHR\n * @param {String} url - The URL of the endpoint\n * @param {Object} options - Object of options for the request\n */\nexport default function(url, options = {}) {\n    const { type, body, responseType } = extend({}, defaults, options);\n\n    return new Promise((resolve, reject) => {\n        try {\n            const xhr = new XMLHttpRequest();\n\n            // Check for CORS support\n            if (!('withCredentials' in xhr)) {\n                const error = new Error('No CORS support');\n                error.request = xhr;\n                throw error;\n            }\n\n            // Handle failures\n            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/status\n            const fail = () => {\n                const error = new Error(xhr.status);\n                error.request = xhr;\n                reject(error);\n            };\n\n            // Successfully made the request\n            xhr.addEventListener('load', () => {\n                const { response } = xhr;\n\n                // Something went wrong either with the request or server\n                if (xhr.status >= 400) {\n                    fail();\n                    return;\n                }\n\n                // Parse JSON responses\n                if (responseType === 'json') {\n                    parseJSON(response)\n                        .then(json => {\n                            if (json.success) {\n                                resolve(json.data);\n                            } else {\n                                const error = new Error('Request failed');\n                                error.errors = json.errors;\n                                reject(error);\n                            }\n                        })\n                        .catch(reject);\n                } else {\n                    resolve(response);\n                }\n            });\n\n            // Request failed\n            xhr.addEventListener('error', fail);\n\n            // Add version to URL\n            const endpoint = parseUrl(url);\n            endpoint.searchParams.set('v', version);\n\n            // Start the request\n            xhr.open(type, endpoint, true);\n\n            // Add version header\n            // xhr.setRequestHeader('x-sdk-version', version);\n\n            // Set the required response type\n            // 'json' responseType is much slower, so we parse later\n            // https://github.com/arendjr/fetch-vs-xhr-perf\n            if (responseType !== 'json') {\n                xhr.responseType = responseType;\n            }\n\n            // Send data if passed\n            xhr.send(buildFormData(body));\n        } catch (error) {\n            reject(error);\n        }\n    });\n}\n","// ==========================================================================\n// Common fetch actions\n// ==========================================================================\n\nimport fetch from './fetch';\n\nconst queue = {};\n\nconst http = {\n    /**\n     * GET remote URL and parse as JSON\n     * @param {String} url - The endpoint URL\n     */\n    get(url) {\n        // Queue requests to prevent hammering\n        if (!Object.keys(queue).includes(url)) {\n            queue[url] = fetch(url);\n\n            const remove = () => {\n                delete queue[url];\n            };\n\n            // Remove from queue on completed\n            queue[url].then(remove).catch(remove);\n        }\n\n        return queue[url];\n    },\n\n    /**\n     * POST to remote URL and parse as JSON\n     * @param {String} url - The endpoint URL\n     * @param {Object} data - The POST data payload\n     */\n    post(url, data = {}) {\n        const options = {\n            type: 'POST',\n            body: data,\n        };\n\n        console.warn('POST', data);\n\n        return fetch(url, options);\n    },\n};\n\nexport default http;\n","// ==========================================================================\n// Local storage wrapper\n// TODO: methods should return promises?\n// ==========================================================================\n\nimport Store from '../models/Store';\nimport { dedupe } from './arrays';\nimport is from './is';\nimport { extend } from './objects';\nimport parseUrl from './parseUrl';\n\nconst storage = new Map();\n\nconst getKey = url => {\n    if (url === null) {\n        return null;\n    }\n\n    const parsed = parseUrl(url);\n\n    if (parsed === null) {\n        return null;\n    }\n\n    return `${parsed.host}${parsed.pathname}`.replace(/\\/$/, '');\n};\n\nclass Storage {\n    constructor(config) {\n        this.config = Object.assign(\n            {\n                keys: {\n                    root: 'selz-js-sdk',\n                    carts: 'carts',\n                    stores: 'stores',\n                },\n                ttl: 3600, // 1 hour\n                schema: new Date('2018-07-02').getTime(), // Schema version (allowing us to change data schema and invalidate storage)\n            },\n            config,\n        );\n\n        this.purge();\n    }\n\n    // Check for actual support (see if we can use it)\n    static get supported() {\n        if (!window.localStorage) {\n            return false;\n        }\n\n        const key = '___test';\n\n        // Try to use it\n        try {\n            window.localStorage.setItem(key, key);\n            window.localStorage.removeItem(key);\n            return true;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    get(key) {\n        let data = storage.get(this.config.keys.root);\n\n        // Grab from real storage if we can or use faux-storage\n        if (Storage.supported) {\n            const stored = window.localStorage.getItem(this.config.keys.root);\n\n            if (!is.empty(stored)) {\n                data = JSON.parse(stored);\n            }\n        }\n\n        if (is.empty(data)) {\n            return null;\n        }\n\n        if (!is.empty(key)) {\n            return Object.keys(data).includes(key) ? data[key] : null;\n        }\n\n        return data;\n    }\n\n    set(key, value, merge = false) {\n        // Get current storage\n        const data = this.get() || {};\n\n        // Extend with the new data\n        if (merge && Object.keys(data).includes(key)) {\n            data[key] = extend(data[key], value);\n        } else {\n            data[key] = value;\n        }\n\n        // Set in faux-storage\n        storage.set(this.config.keys.root, data);\n\n        // Bail if no real support\n        if (!Storage.supported) {\n            return;\n        }\n\n        // Set schema version\n        data.schema = this.config.schema;\n\n        // Update storage\n        try {\n            window.localStorage.setItem(this.config.keys.root, JSON.stringify(data));\n        } catch (e) {\n            // Do nothing\n        }\n    }\n\n    // Clean up stale storage\n    purge() {\n        // Check schema\n        const data = this.get();\n\n        // Nothing to purge\n        if (is.empty(data)) {\n            return;\n        }\n\n        // If schema does not match, kill it\n        if (Number(data.schema) !== this.config.schema) {\n            window.localStorage.removeItem(this.config.keys.root);\n            return;\n        }\n\n        // Get current list of stores\n        const stores = this.get(this.config.keys.stores) || [];\n\n        // Nothing to cleanup\n        if (is.empty(stores)) {\n            return;\n        }\n\n        // Check TTL is valid\n        this.set(\n            this.config.keys.stores,\n            stores.filter(store => {\n                const ttl = Number(store.ttl);\n                return ttl > 0 && ttl > Date.now();\n            }),\n        );\n    }\n\n    getCarts(store) {\n        const data = this.get(this.config.keys.carts) || {};\n\n        // If no carts\n        if (is.empty(data)) {\n            return null;\n        }\n\n        // Get all carts\n        if (!is.number(store)) {\n            return data;\n        }\n\n        // Store not found\n        if (!Object.keys(data).includes(store.toString())) {\n            return null;\n        }\n\n        // Get all for a store\n        return data[store.toString()];\n    }\n\n    getCart(store, currency) {\n        const carts = this.getCarts(store);\n\n        // No carts\n        if (is.empty(carts)) {\n            return null;\n        }\n\n        // Get all for a store\n        if (!is.string(currency)) {\n            return carts;\n        }\n\n        // Currency not found\n        if (!Object.keys(carts).includes(currency.toUpperCase())) {\n            return null;\n        }\n\n        return carts[currency.toUpperCase()];\n    }\n\n    setCart(store, currency, cart) {\n        this.set(\n            this.config.keys.carts,\n            {\n                [store]: {\n                    [currency.toUpperCase()]: {\n                        id: cart.id,\n                        active: cart.active,\n                    },\n                },\n            },\n            true,\n        );\n    }\n\n    setCarts(store, carts = {}) {\n        this.set(this.config.keys.carts, {\n            [store]: carts,\n        });\n    }\n\n    getStore(input) {\n        let store = null;\n\n        if (!is.number(input) && !is.url(input)) {\n            return null;\n        }\n\n        const stores = this.get(this.config.keys.stores) || [];\n\n        if (is.number(input)) {\n            store = stores.find(s => is.object(s.data) && s.data.id === input);\n        } else if (is.url(input)) {\n            const key = getKey(input);\n\n            // Bail if invalid URL\n            if (key === null) {\n                return null;\n            }\n\n            store = stores.find(s => is.array(s.urls) && s.urls.includes(key));\n        }\n\n        if (!is.object(store)) {\n            return null;\n        }\n\n        // Check TTL is valid\n        const ttl = Number(store.ttl);\n\n        if (ttl > 0 && ttl < Date.now()) {\n            this.purge();\n            return null;\n        }\n\n        return new Store(store.data);\n    }\n\n    setStore(data, url = null) {\n        // Strip the protocol from the lookup url\n        const key = getKey(url);\n\n        // Get current list of stores\n        const stores = this.get(this.config.keys.stores) || [];\n        let existing = null;\n\n        if (!is.empty(stores)) {\n            // Find existing store by id\n            existing = stores.find(s => s.data.id === data.id);\n        }\n\n        // Extend TTL each\n        const ttl = Date.now() + this.config.ttl;\n\n        // If we found something\n        if (is.object(existing)) {\n            // Update data and extend TTL\n            Object.assign(existing, {\n                data,\n                ttl,\n            });\n\n            if (key !== null) {\n                // Add the URL key for later lookup\n                if (!is.array(existing.urls)) {\n                    existing.urls = [key];\n                } else {\n                    existing.urls.push(key);\n                }\n\n                // Remove duplicate entries\n                const urls = dedupe(existing.urls);\n\n                // Add to existing record\n                Object.assign(existing, {\n                    urls,\n                });\n            }\n        } else {\n            const store = {\n                data,\n                ttl,\n            };\n\n            if (key !== null) {\n                Object.assign(store, {\n                    urls: [key],\n                });\n            }\n\n            stores.push(store);\n        }\n\n        this.set(this.config.keys.stores, stores);\n    }\n}\n\nexport default Storage;\n","// ==========================================================================\n// Array utils\n// ==========================================================================\n\nimport is from './is';\n\n/**\n * Remove duplicates in an array\n * @param {array} array\n */\nexport function dedupe(array) {\n    if (!is.array(array)) {\n        return array;\n    }\n\n    return array.filter((item, index) => array.indexOf(item) === index);\n}\n\n// Rounding methods for .closest()\nconst closestRounding = {\n    none: 0,\n    ceil: 1,\n    floor: 2,\n};\nexport { closestRounding };\n\n/**\n * Get the closest value in an array\n * @param {array} array\n * @param {number} value\n * @param {number} rounding\n */\nexport function closest(array, value, rounding = closestRounding.none) {\n    if (!is.array(array) || !array.length) {\n        return null;\n    }\n\n    return array.reduce((prev, curr) => {\n        if (Math.abs(curr - value) <= Math.abs(prev - value)) {\n            switch (rounding) {\n                case closestRounding.ceil:\n                    return curr >= value ? curr : prev;\n\n                case closestRounding.floor:\n                    return curr <= value ? curr : prev;\n\n                default:\n                    return curr;\n            }\n        }\n\n        return prev;\n    });\n}\n","import config from './config';\nimport { Cart, CartAddItem, CartItem } from './models/Cart';\nimport Category from './models/Category';\nimport Product from './models/Product';\nimport Store from './models/Store';\nimport http from './utils/http';\nimport is from './utils/is';\nimport Storage from './utils/storage';\n\nclass Client {\n    constructor(props) {\n        const { env, store, source } = props;\n\n        this.env = !is.empty(env) ? env : '';\n        this.store = store;\n        this.source = source;\n\n        if (!is.url(store) && !is.number(store)) {\n            throw Error('A store ID or URL is required to create a client');\n        }\n\n        this.storage = new Storage();\n    }\n\n    /**\n     * Get the store ID only\n     */\n    getStoreId() {\n        return new Promise((resolve, reject) => {\n            if (is.number(this.store)) {\n                resolve(this.store);\n                return;\n            }\n\n            if (this.store instanceof Store) {\n                resolve(this.store.id);\n                return;\n            }\n\n            // URL is required\n            if (!is.url(this.store)) {\n                reject(new Error('Url is required for user lookup'));\n            }\n\n            // Get by URL\n            this.getStore()\n                .then(store => {\n                    resolve(store.id);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get the Store for current instance\n     */\n    getStore() {\n        return new Promise((resolve, reject) => {\n            // Try from cache by ID or URL\n            if (is.number(this.store) || is.url(this.store)) {\n                const cached = this.storage.getStore(this.store);\n\n                // Return cached if we have it\n                if (cached !== null && cached instanceof Store) {\n                    resolve(cached);\n                    return;\n                }\n            }\n\n            // If already fetched\n            if (this.store instanceof Store) {\n                resolve(this.store);\n                return;\n            }\n\n            // Fetch from remote by ID or URL\n            const url = config.urls.store(this.env, this.store);\n\n            http.get(url)\n                .then(store => {\n                    this.setStore(store);\n                    resolve(this.store);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Set the store details\n     * @param {object} store\n     */\n    setStore(store) {\n        if (!is.object(store)) {\n            return;\n        }\n\n        // Store reference to lookup URL\n        const url = is.url(this.store) ? this.store : null;\n\n        // Map to Store\n        this.store = new Store(store);\n\n        // Add to storage for cache\n        this.storage.setStore(this.store, url);\n    }\n\n    /**\n     * Get product data\n     * @param {String} url - Short or full URL for a product\n     */\n    getProduct(url) {\n        return new Promise((resolve, reject) => {\n            http.get(config.urls.product(this.env, url))\n                .then(json => {\n                    if (!(this.store instanceof Store)) {\n                        this.setStore(json.store);\n                    }\n\n                    resolve(new Product(this, json));\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get all products\n     */\n    getProducts(keyword = '', category = '', page = 1) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    http.get(\n                        config.urls.products(\n                            this.env,\n                            id,\n                            !is.empty(keyword) ? keyword : '',\n                            is.string(category) ? category : '',\n                            !is.number(page) || page < 1 ? 1 : page,\n                        ),\n                    )\n                        .then(json => {\n                            resolve(\n                                Object.assign({}, json, {\n                                    products: json.products.map(p => new Product(this, p)),\n                                }),\n                            );\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get all categories\n     */\n    getCategories() {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    http.get(config.urls.categories(this.env, id))\n                        .then(json => {\n                            resolve(\n                                Object.assign({}, json, {\n                                    categories: json.categories.map(c => new Category(c)),\n                                }),\n                            );\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Create a new shopping cart\n     * @param {String} currency - ISO currency code\n     * @param {String} discount - Discount code\n     */\n    createCart(currency, discount) {\n        return new Promise((resolve, reject) => {\n            if (is.empty(currency)) {\n                reject(new Error('currency is required'));\n                return;\n            }\n\n            this.getStoreId()\n                .then(id => {\n                    const currencyCode = currency.toUpperCase();\n\n                    http.post(config.urls.createCart(this.env, id), {\n                        currency: currencyCode,\n                        discount: !is.empty(discount) ? discount : null,\n                        source: this.source,\n                    })\n                        .then(json => {\n                            const cart = new Cart(this, json);\n\n                            // Store reference to cart id for later\n                            this.storage.setCart(id, currencyCode, cart);\n\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get a shopping cart or create one if needed\n     * @param {String} currency - The shopping cart ISO currency code\n     */\n    getCartId(currency) {\n        return new Promise((resolve, reject) => {\n            if (!is.currencyCode(currency)) {\n                reject(new Error('A valid currency code is required'));\n                return;\n            }\n\n            this.getStoreId()\n                .then(id => {\n                    const currencyCode = currency.toUpperCase();\n                    const currentCart = this.storage.getCart(id, currencyCode);\n\n                    // Create cart if it doesn't exist\n                    if (is.empty(currentCart)) {\n                        this.createCart(currencyCode)\n                            .then(cart => resolve(cart.id))\n                            .catch(reject);\n                    } else {\n                        resolve(currentCart.id);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get a shopping cart\n     * @param {String} input - The shopping cart ISO currency code or cart ID\n     */\n    getCart(input) {\n        return new Promise((resolve, reject) => {\n            const isCurrency = is.currencyCode(input);\n            const isObjectId = is.objectId(input);\n\n            if (!isCurrency && !isObjectId) {\n                reject(new Error('A valid currency code or cart id are required'));\n                return;\n            }\n\n            if (isCurrency) {\n                const currencyCode = input.toUpperCase();\n\n                this.getCartId(currencyCode)\n                    .then(id => {\n                        if (is.empty(id)) {\n                            reject(new Error(`Could not find matching cart for currency code '${currencyCode}'`));\n                            return;\n                        }\n\n                        this.getCart(id)\n                            .then(cart => {\n                                // Update store\n                                this.setStore(cart.store);\n\n                                resolve(cart);\n                            })\n                            .catch(reject);\n                    })\n                    .catch(reject);\n            } else {\n                http.get(config.urls.getCart(this.env, input))\n                    .then(json => {\n                        const activeId = this.getActiveCart();\n                        const cart = new Cart(this, json, json.id === activeId);\n\n                        // Update store\n                        this.setStore(cart.store);\n\n                        resolve(cart);\n                    })\n                    .catch(reject);\n            }\n        });\n    }\n\n    /**\n     * Get all current carts\n     */\n    getCarts(validate = true) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    const carts = this.storage.getCarts(id);\n\n                    if (is.empty(carts)) {\n                        resolve(null);\n                        return;\n                    }\n\n                    // Check the carts still exist in the server\n                    if (validate) {\n                        const ids = Object.keys(carts).map(currency => carts[currency].id);\n\n                        http.get(config.urls.checkCarts(this.env, ids.join(',')))\n                            .then(json => {\n                                // Remove non existant carts\n                                Object.entries(json).forEach(([cartId, exists]) => {\n                                    if (!exists) {\n                                        const currency = Object.keys(carts).find(c => carts[c].id === cartId);\n                                        delete carts[currency];\n                                    }\n                                });\n\n                                // Store again\n                                this.storage.setCarts(id, carts);\n\n                                // Set active\n                                if (!Object.values(carts).find(cart => cart.active)) {\n                                    this.setActiveCart()\n                                        .then(resolve)\n                                        .catch(reject);\n                                } else {\n                                    resolve(carts);\n                                }\n                            })\n                            .catch(reject);\n                    } else {\n                        resolve(carts);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Set the active cart based on currency\n     * @param {String} input - The shopping cart ISO currency code or cart ID\n     */\n    setActiveCart(input = null) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    this.getCarts(false).then(data => {\n                        const carts = data;\n\n                        // No carts\n                        if (is.empty(carts)) {\n                            resolve(null);\n                            return;\n                        }\n\n                        // Currency code was passed...\n                        if (is.currencyCode(input)) {\n                            const currencyCode = input.toUpperCase();\n                            const currencies = Object.keys(carts);\n\n                            // Bail if not included\n                            if (!currencies.includes(currencyCode)) {\n                                reject(new Error(`No carts for ${currencyCode}`));\n                                return;\n                            }\n\n                            // Set active\n                            currencies.forEach(currency => {\n                                carts[currency].active = currency === currencyCode;\n                            });\n                        } else {\n                            // Set to id if specified, otherwise first\n                            const cartId = is.objectId(input) ? input : carts[Object.keys(carts)[0]].id;\n\n                            // Set active\n                            Object.keys(carts).forEach(currency => {\n                                const cart = carts[currency];\n                                cart.active = cart.id === cartId;\n                            });\n                        }\n\n                        // Store again\n                        this.storage.setCarts(id, carts);\n\n                        resolve(carts);\n                    });\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get the current active cart\n     */\n    getActiveCart(fetch = false) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    const carts = this.storage.getCarts(id);\n\n                    if (!Object.keys(carts).length) {\n                        resolve(null);\n                        return;\n                    }\n\n                    const active = Object.values(carts).find(cart => cart.active);\n\n                    if (!active) {\n                        resolve(null);\n                        return;\n                    }\n\n                    if (!fetch) {\n                        resolve(active.id);\n                        return;\n                    }\n\n                    this.getCart(active.id)\n                        .then(resolve)\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Add a product to a cart\n     * @param {String} id - The cart ID\n     * @param {Object} item - The cart item\n     */\n    addToCart(id, item) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(item)) {\n                reject(new Error('A cart item is required'));\n                return;\n            }\n\n            // Map the cart item if required\n            let cartItem = item;\n            if (is.object(item) || item instanceof Product) {\n                cartItem = new CartAddItem(item);\n            }\n\n            if (!(cartItem instanceof CartAddItem)) {\n                reject(new Error('A valid cart item is required'));\n            }\n\n            http.post(config.urls.addToCart(this.env, id), cartItem)\n                .then(json => {\n                    const cart = new Cart(this, json, true);\n\n                    // Update store\n                    this.setStore(cart.store);\n\n                    // Set the active cart\n                    this.setActiveCart(cart.id)\n                        .then(() => {\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Update an items quantity in the shopping cart\n     * @param {String} id - The shopping cart ID\n     * @param {String} index - The shopping cart item quid\n     * @param {Number} quantity - Desired quantity\n     */\n    updateCartItemQuantity(id, index, quantity = 1) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(index)) {\n                reject(new Error('A valid index is required'));\n                return;\n            }\n\n            http.post(config.urls.updateCartItemQuantity(this.env, id), { index, quantity })\n                .then(json => {\n                    const cart = new Cart(this, json, true);\n\n                    // Update store\n                    this.setStore(cart.store);\n\n                    // Set the active cart\n                    this.setActiveCart(cart.id)\n                        .then(() => {\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Remove a product from a cart\n     * @param {String} id - The shopping cart id\n     * @param {String} index - The shopping cart item guid\n     */\n    removeFromCart(id, index) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(index)) {\n                reject(new Error('A valid index is required'));\n                return;\n            }\n\n            http.post(config.urls.removeFromCart(this.env, id), { index })\n                .then(json => {\n                    // If there's actually a cart left, map it\n                    if (!is.empty(json)) {\n                        const cart = new Cart(this, json, true);\n\n                        // Set the active cart\n                        this.setActiveCart(cart.id)\n                            .then(() => {\n                                resolve(cart);\n                            })\n                            .catch(reject);\n                    } else {\n                        // Otherwise, update carts (as one removed)\n                        this.getCarts()\n                            .then(() => resolve(null))\n                            .catch(reject);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n}\n\nexport { Product, Category, Cart, CartItem, CartAddItem, Store };\n\nexport default Client;\n"]}