{"version":3,"file":"client.mjs","sources":["src/utils/is.js","src/config.js","src/models/Product.js","src/models/Cart.js","src/models/Store.js","src/utils/fetch.js","src/utils/strings.js","src/utils/form-data.js","src/utils/http.js","src/utils/arrays.js","src/utils/extend.js","src/utils/parseUrl.js","src/utils/storage.js","src/client.js"],"sourcesContent":["// ==========================================================================\n// Type checking\n// ==========================================================================\n\nconst getConstructor = input => (input !== null && typeof input !== 'undefined' ? input.constructor : null);\nconst instanceOf = (input, constructor) => Boolean(input && constructor && input instanceof constructor);\nconst isArray = input => Array.isArray(input);\nconst isObject = input => getConstructor(input) === Object;\nconst isNumber = input => getConstructor(input) === Number && !Number.isNaN(input);\nconst isString = input => getConstructor(input) === String;\nconst isBoolean = input => getConstructor(input) === Boolean;\nconst isFunction = input => getConstructor(input) === Function;\nconst isNullOrUndefined = input => input === null || typeof input === 'undefined';\nconst isObjectId = input => isString(input) && /^[a-f\\d]{24}$/i.test(input);\nconst isCurrencyCode = input => isString(input) && /^[A-z]{3}$/.test(input);\n\nconst isEmpty = input =>\n    isNullOrUndefined(input) ||\n    ((isString(input) || isArray(input)) && !input.length) ||\n    (isObject(input) && !Object.keys(input).length);\n\nconst isUrl = (input, strict = false) => {\n    // Accept a URL object\n    if (instanceOf(input, window.URL)) {\n        return true;\n    }\n\n    // Add the protocol if required\n    let string = input;\n    if (!strict && !/^https?:\\/\\/*/.test(input)) {\n        string = `http://${input}`;\n    }\n\n    try {\n        return !isEmpty(new URL(string).hostname);\n    } catch (e) {\n        return false;\n    }\n};\n\nconst is = {\n    array: isArray,\n    object: isObject,\n    number: isNumber,\n    string: isString,\n    boolean: isBoolean,\n    function: isFunction,\n    nullOrUndefined: isNullOrUndefined,\n    objectId: isObjectId,\n    currencyCode: isCurrencyCode,\n    url: isUrl,\n    empty: isEmpty,\n};\n\nexport default is;\n","import is from './utils/is';\n\nfunction getBase(env) {\n    return `https://${!is.empty(env) ? `${env}-` : ''}selz.com/sdk/`;\n}\n\nconst config = {\n    urls: {\n        /**\n         * Get URL for product data by URL\n         * @param {string} env - Environment (for internal use)\n         * @param {string} url - Short or full URL for a product\n         */\n        product(env, url = '') {\n            return `${getBase(env)}products/find?url=${url}`;\n        },\n\n        /**\n         * Get URL for all products by store ID\n         * @param {string} env - Environment (for internal use)\n         * @param {string} id - The store ID\n         * @param {string} query - Search query\n         * @param {number} page - Page to fetch\n         */\n        products(env, id, query = '', page = 1) {\n            return `${getBase(env)}products/all${id}?q=${query}&p=${page}`;\n        },\n\n        /**\n         * Get URL for finding a store by URL or ID\n         * @param {string} env - Environment (for internal use)\n         * @param {number|string} input - The ID or URL to lookup\n         */\n        store(env, input = null) {\n            if (is.number(input)) {\n                return `${getBase(env)}store/find/${input}`;\n            }\n\n            return `${getBase(env)}store/find?url=${input}`;\n        },\n\n        /**\n         * Create a new cart\n         * @param {string} env - Environment (for internal use)\n         * @param {number} id - Store ID\n         */\n        createCart(env, id = '') {\n            return `${getBase(env)}cart/create/${id}`;\n        },\n\n        /**\n         * Get cart from ID\n         * @param {string} env - Environment (for internal use)\n         * @param {string} id - Cart ID\n         */\n        getCart(env, id = '') {\n            return `${getBase(env)}cart/${id}`;\n        },\n\n        /**\n         * Check carts still exist server side\n         * @param {string} env - Environment (for internal use)\n         * @param {number} id - Cart IDs\n         */\n        checkCarts(env, ids = '') {\n            return `${getBase(env)}cart/verify?ids=${ids}`;\n        },\n\n        /**\n         * Add product to cart\n         * @param {string} env - Environment (for internal use)\n         * @param {string} id - Cart ID\n         */\n        addToCart(env, id = '') {\n            return `${getBase(env)}cart/add/${id}`;\n        },\n\n        /**\n         * Update a cart item quantity\n         * @param {string} env - Environment (for internal use)\n         * @param {string} id - Cart ID\n         */\n        updateCartItemQuantity(env, id = '') {\n            return `${getBase(env)}cart/updateitemquantity/${id}`;\n        },\n\n        /**\n         * Remove product from cart\n         * @param {string} env - Environment (for internal use)\n         * @param {string} id - Cart ID\n         */\n        removeFromCart(env, id = '') {\n            return `${getBase(env)}cart/remove/${id}`;\n        },\n    },\n};\n\nexport default config;\n","import is from '../utils/is';\n\nlet client = null;\n\nclass ProductUrls {\n    constructor(urls) {\n        // Take all properties by default\n        Object.assign(this, urls);\n    }\n}\n\nclass ProductImage {\n    constructor(image) {\n        // Take all properties by default\n        Object.assign(this, image);\n    }\n}\n\nclass ProductMedia {\n    constructor(media) {\n        // Take all properties by default\n        Object.assign(this, media);\n\n        // Map cover image\n        this.cover = new ProductImage(media.cover);\n    }\n}\n\nclass ProductFile {\n    constructor(file) {\n        // Take all properties by default\n        Object.assign(this, file);\n    }\n}\n\nclass ProductVariant {\n    constructor(variant, selected = '') {\n        // Take all properties by default\n        Object.assign(this, variant);\n\n        this.selected = variant.id === selected;\n    }\n}\n\nclass ProductVariantAttributeOption {\n    constructor(id, label) {\n        this.id = id;\n        this.label = label;\n    }\n}\n\nclass ProductVariantAttribute {\n    constructor(variant) {\n        // Take all properties by default\n        Object.assign(this, variant);\n\n        // Map options\n        this.options = Object.keys(variant.options).map(\n            id => new ProductVariantAttributeOption(id, variant.options[id]),\n        );\n    }\n}\n\nclass Product {\n    constructor(instance, product, variantId = '') {\n        if (!is.object(product)) {\n            return;\n        }\n\n        client = instance;\n\n        // Take all properties by default\n        Object.assign(this, product);\n\n        // Map store\n        this.store = client.store;\n\n        // Product URLs\n        if (is.object(product.urls)) {\n            this.urls = new ProductUrls(product.urls);\n        }\n\n        // Media (Video, YouTube, Vimeo, Audio)\n        if (is.object(product.media)) {\n            this.media = new ProductMedia(product.media);\n        }\n\n        // Images\n        if (is.array(product.images)) {\n            this.images = product.images.map(image => new ProductImage(image));\n        }\n\n        // Files for digital products\n        if (is.array(product.files)) {\n            this.files = product.files.map(file => new ProductFile(file));\n        }\n\n        // Variants\n        if (is.array(product.variants) && product.variants.length) {\n            const selected = !is.empty(variantId) ? variantId : product.variants[0].id;\n            this.variants = product.variants.map(variant => new ProductVariant(variant, selected));\n        }\n        if (is.array(product.variant_attributes) && product.variant_attributes.length) {\n            this.variant_attributes = product.variant_attributes.map(\n                attribute => new ProductVariantAttribute(attribute),\n            );\n        }\n    }\n\n    // eslint-disable-next-line camelcase\n    get featured_image() {\n        return this.images.find(image => image.is_featured);\n    }\n\n    // eslint-disable-next-line camelcase\n    get is_sold_out() {\n        return this.quantity_available === 0;\n    }\n\n    // eslint-disable-next-line camelcase\n    get selected_variant() {\n        if (is.empty(this.variants)) {\n            return null;\n        }\n\n        return this.variants.find(variant => variant.selected);\n    }\n}\n\nexport default Product;\n","import Product from './Product';\n\nlet client = null;\n\nclass CartItem {\n    constructor(item, cartId) {\n        this.cartId = cartId;\n\n        // Semi private for quantity updates so we can bind to getters/setters\n        let _quantity = item.quantity;\n\n        // Take all properties by default\n        Object.assign(this, item, {\n            _setQuantity: (quantity = 1) => {\n                _quantity = quantity;\n                client.updateCartItemQuantity(this.cartId, this.index, quantity);\n            },\n            _getQuantity: () => _quantity,\n            get quantity() {\n                return this._getQuantity();\n            },\n            set quantity(quantity) {\n                this._setQuantity(quantity);\n            },\n        });\n\n        // Map product\n        this.product = new Product(client, item.product, item.variant_id);\n    }\n}\n\nclass Cart {\n    constructor(instance, cart, active = false) {\n        if (cart === null) {\n            return;\n        }\n\n        client = instance;\n\n        // Take all properties by default\n        Object.assign(this, cart);\n\n        // Map store\n        this.store = client.store;\n\n        // Set active state\n        this.active = active;\n\n        // Map items\n        this.items = Array.from(cart.items).map(item => new CartItem(item, cart.id));\n    }\n\n    /**\n     * Add a product to this cart\n     * @param {object} product - The product details\n     */\n    add(product) {\n        return client.addToCart(this.id, product);\n    }\n\n    /**\n     * Remove a product from this cart\n     * @param {string} index\n     */\n    remove(index) {\n        return client.removeFromCart(this.id, index);\n    }\n}\n\nexport default Cart;\n","import is from '../utils/is';\n\nclass Store {\n    constructor(store = null) {\n        if (!is.object(store)) {\n            return;\n        }\n\n        // Take all properties by default\n        Object.assign(this, store);\n    }\n}\n\nexport default Store;\n","// ==========================================================================\n// Fetch\n// ==========================================================================\n\n/**\n * Custom fetch wrapper\n * @param {string} url - The URL of the endpoint\n * @param {object} options - Object of options for the request\n */\nexport default function(url, options) {\n    const defaults = {\n        mode: 'cors',\n        redirect: 'follow',\n    };\n\n    return new Promise((resolve, reject) => {\n        const request = new Request(url, Object.assign(defaults, options));\n        request.headers.append('Accept', 'application/json');\n\n        fetch(request)\n            .then(response => {\n                if (response.status >= 200 && response.status < 300) {\n                    try {\n                        response\n                            .json()\n                            .then(json => {\n                                if (json.success) {\n                                    resolve(json.data);\n                                } else {\n                                    const error = new Error('Request failed');\n                                    error.errors = json.errors;\n                                    throw error;\n                                }\n                            })\n                            .catch(reject);\n                    } catch (error) {\n                        throw error;\n                    }\n                } else {\n                    const error = new Error(response.status);\n                    error.response = response;\n                    throw error;\n                }\n            })\n            .catch(reject);\n    });\n}\n","// ==========================================================================\n// String utils\n// ==========================================================================\n\n// Replace all occurances of a string in a string\nexport function replaceAll(input = '', find = '', replace = '') {\n    return input.replace(\n        new RegExp(find.toString().replace(/([.*+?^=!:${}()|[\\]/\\\\])/g, '\\\\$1'), 'g'),\n        replace.toString(),\n    );\n}\n\n// Convert to title case\nexport function toTitleCase(input = '') {\n    return input.toString().replace(/\\w\\S*/g, text => text.charAt(0).toUpperCase() + text.substr(1).toLowerCase());\n}\n\n// Convert string to pascalCase\nexport function toPascalCase(input = '') {\n    let string = input.toString();\n\n    // Convert kebab case\n    string = replaceAll(string, '-', ' ');\n\n    // Convert snake case\n    string = replaceAll(string, '_', ' ');\n\n    // Convert to title case\n    string = toTitleCase(string);\n\n    // Convert to pascal case\n    return replaceAll(string, ' ', '');\n}\n\n// Convert string to pascalCase\nexport function toCamelCase(input = '') {\n    let string = input.toString();\n\n    // Convert to pascal case\n    string = toPascalCase(string);\n\n    // Convert first character to lowercase\n    return string.charAt(0).toLowerCase() + string.slice(1);\n}\n","// ==========================================================================\n// Form Data utils\n// ==========================================================================\n\nimport is from './is';\nimport { toPascalCase } from './strings';\n\n/**\n * Convert an Object to FormData\n * @param {object} source - source Object\n * @param {formdata} form - existing FormData object\n * @param {string} namespace - namespace for FormData\n */\nconst buildFormData = (source, form, namespace) => {\n    const data = form || new FormData();\n    let formKey;\n\n    // Source must be an object\n    if (!is.object(source)) {\n        return data;\n    }\n\n    // Loop through the object to convert\n    Object.keys(source).forEach(key => {\n        if (namespace) {\n            formKey = `${namespace}[${key}]`;\n        } else {\n            formKey = key;\n        }\n\n        // If the property is an object, but not a File, use recursivity\n        if (typeof source[key] === 'object' && !(source[key] instanceof File)) {\n            buildFormData(source[key], data, key);\n        } else {\n            data.append(toPascalCase(formKey), source[key]);\n        }\n    });\n\n    return data;\n};\n\nexport default buildFormData;\n","// ==========================================================================\n// Common fetch actions\n// ==========================================================================\n\nimport fetch from './fetch';\nimport buildFormData from './form-data';\nimport is from './is';\n\nconst queue = {};\n\nconst http = {\n    /**\n     * GET remote URL and parse as JSON\n     * @param {string} url - The endpoint URL\n     */\n    get(url) {\n        // Queue requests to prevent hammering\n        if (!Object.keys(queue).includes(url)) {\n            queue[url] = fetch(url);\n\n            const remove = () => {\n                delete queue[url];\n            };\n\n            // Remove from queue on completed\n            queue[url].then(remove).catch(remove);\n        }\n\n        return queue[url];\n    },\n\n    /**\n     * POST to remote URL and parse as JSON\n     * @param {string} url - The endpoint URL\n     * @param {object} data - The POST data payload\n     */\n    post(url, data) {\n        const options = {\n            method: 'POST',\n        };\n\n        // Convert POST data to FormData for C#\n        if (is.object(data)) {\n            options.body = buildFormData(data);\n        }\n\n        return fetch(url, options);\n    },\n};\n\nexport default http;\n","// ==========================================================================\n// Array utils\n// ==========================================================================\n\nimport is from './is';\n\n/**\n * Remove duplicates in an array\n * @param {array} array\n */\nexport function dedupe(array) {\n    if (!is.array(array)) {\n        return array;\n    }\n\n    return array.filter((item, index) => array.indexOf(item) === index);\n}\n\n// Rounding methods for .closest()\nconst closestRounding = {\n    none: 0,\n    ceil: 1,\n    floor: 2,\n};\nexport { closestRounding };\n\n/**\n * Get the closest value in an array\n * @param {array} array\n * @param {number} value\n * @param {number} rounding\n */\nexport function closest(array, value, rounding = closestRounding.none) {\n    if (!is.array(array) || !array.length) {\n        return null;\n    }\n\n    return array.reduce((prev, curr) => {\n        if (Math.abs(curr - value) <= Math.abs(prev - value)) {\n            switch (rounding) {\n                case closestRounding.ceil:\n                    return curr >= value ? curr : prev;\n\n                case closestRounding.floor:\n                    return curr <= value ? curr : prev;\n\n                default:\n                    return curr;\n            }\n        }\n\n        return prev;\n    });\n}\n","// ==========================================================================\n// Extend objects\n// ==========================================================================\n\nimport is from './is';\n\n// Deep extend destination object with N more objects\nconst extend = (target = {}, ...sources) => {\n    if (!sources.length) {\n        return target;\n    }\n\n    const source = sources.shift();\n\n    if (!is.object(source)) {\n        return target;\n    }\n\n    Object.keys(source).forEach(key => {\n        if (is.object(source[key])) {\n            if (!Object.keys(target).includes(key)) {\n                Object.assign(target, { [key]: {} });\n            }\n\n            extend(target[key], source[key]);\n        } else {\n            Object.assign(target, { [key]: source[key] });\n        }\n    });\n\n    return extend(target, ...sources);\n};\n\nexport default extend;\n","/**\n * Parse a string to URL object\n * @param {String} url\n */\nexport default function parseUrl(url) {\n    let string = url;\n\n    // Add the protocol if required\n    if (!/^https?:\\/\\/*/.test(url)) {\n        string = `http://${url}`;\n    }\n\n    try {\n        return new URL(string);\n    } catch (e) {\n        return null;\n    }\n}\n","// ==========================================================================\n// Local storage wrapper\n// TODO: methods should return promises?\n// ==========================================================================\n\nimport Store from '../models/Store';\nimport { dedupe } from './arrays';\nimport extend from './extend';\nimport is from './is';\nimport parseUrl from './parseUrl';\n\nconst storage = new Map();\n\nconst getKey = url => {\n    if (url === null) {\n        return null;\n    }\n\n    const parsed = parseUrl(url);\n\n    if (parsed === null) {\n        return null;\n    }\n\n    return `${parsed.host}${parsed.pathname}`.replace(/\\/$/, '');\n};\n\nclass Storage {\n    constructor(config) {\n        this.config = Object.assign(\n            {\n                keys: {\n                    root: 'selz-js-sdk',\n                    carts: 'carts',\n                    stores: 'stores',\n                },\n                ttl: 3600, // 1 hour\n                schema: new Date('2018-07-02').getTime(), // Schema version (allowing us to change data schema and invalidate storage)\n            },\n            config,\n        );\n\n        this.purge();\n    }\n\n    // Check for actual support (see if we can use it)\n    static get supported() {\n        if (!window.localStorage) {\n            return false;\n        }\n\n        const key = '___test';\n\n        // Try to use it\n        try {\n            window.localStorage.setItem(key, key);\n            window.localStorage.removeItem(key);\n            return true;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    get(key) {\n        let data = storage.get(this.config.keys.root);\n\n        // Grab from real storage if we can or use faux-storage\n        if (Storage.supported) {\n            const stored = window.localStorage.getItem(this.config.keys.root);\n\n            if (!is.empty(stored)) {\n                data = JSON.parse(stored);\n            }\n        }\n\n        if (is.empty(data)) {\n            return null;\n        }\n\n        if (!is.empty(key)) {\n            return Object.keys(data).includes(key) ? data[key] : null;\n        }\n\n        return data;\n    }\n\n    set(key, value, merge = false) {\n        // Get current storage\n        const data = this.get() || {};\n\n        // Extend with the new data\n        if (merge && Object.keys(data).includes(key)) {\n            data[key] = extend(data[key], value);\n        } else {\n            data[key] = value;\n        }\n\n        // Set in faux-storage\n        storage.set(this.config.keys.root, data);\n\n        // Bail if no real support\n        if (!Storage.supported) {\n            return;\n        }\n\n        // Set schema version\n        data.schema = this.config.schema;\n\n        // Update storage\n        try {\n            window.localStorage.setItem(this.config.keys.root, JSON.stringify(data));\n        } catch (e) {\n            // Do nothing\n        }\n    }\n\n    // Clean up stale storage\n    purge() {\n        // Check schema\n        const data = this.get();\n\n        // Nothing to purge\n        if (is.empty(data)) {\n            return;\n        }\n\n        // If schema does not match, kill it\n        if (Number(data.schema) !== this.config.schema) {\n            window.localStorage.removeItem(this.config.keys.root);\n            return;\n        }\n\n        // Get current list of stores\n        const stores = this.get(this.config.keys.stores) || [];\n\n        // Nothing to cleanup\n        if (is.empty(stores)) {\n            return;\n        }\n\n        // Check TTL is valid\n        this.set(\n            this.config.keys.stores,\n            stores.filter(store => {\n                const ttl = Number(store.ttl);\n                return ttl > 0 && ttl > Date.now();\n            }),\n        );\n    }\n\n    getCarts(store) {\n        const data = this.get(this.config.keys.carts) || {};\n\n        // If no carts\n        if (is.empty(data)) {\n            return null;\n        }\n\n        // Get all carts\n        if (!is.number(store)) {\n            return data;\n        }\n\n        // Store not found\n        if (!Object.keys(data).includes(store.toString())) {\n            return null;\n        }\n\n        // Get all for a store\n        return data[store.toString()];\n    }\n\n    getCart(store, currency) {\n        const carts = this.getCarts(store);\n\n        // No carts\n        if (is.empty(carts)) {\n            return null;\n        }\n\n        // Get all for a store\n        if (!is.string(currency)) {\n            return carts;\n        }\n\n        // Currency not found\n        if (!Object.keys(carts).includes(currency.toUpperCase())) {\n            return null;\n        }\n\n        return carts[currency.toUpperCase()];\n    }\n\n    setCart(store, currency, cart) {\n        this.set(\n            this.config.keys.carts,\n            {\n                [store]: {\n                    [currency.toUpperCase()]: {\n                        id: cart.id,\n                        active: cart.active,\n                    },\n                },\n            },\n            true,\n        );\n    }\n\n    setCarts(store, carts = {}) {\n        this.set(this.config.keys.carts, {\n            [store]: carts,\n        });\n    }\n\n    getStore(input) {\n        let store = null;\n\n        if (!is.number(input) && !is.url(input)) {\n            return null;\n        }\n\n        const stores = this.get(this.config.keys.stores) || [];\n\n        if (is.number(input)) {\n            store = stores.find(s => is.object(s.data) && s.data.id === input);\n        } else if (is.url(input)) {\n            const key = getKey(input);\n\n            // Bail if invalid URL\n            if (key === null) {\n                return null;\n            }\n\n            store = stores.find(s => is.array(s.urls) && s.urls.includes(key));\n        }\n\n        if (!is.object(store)) {\n            return null;\n        }\n\n        // Check TTL is valid\n        const ttl = Number(store.ttl);\n\n        if (ttl > 0 && ttl < Date.now()) {\n            this.purge();\n            return null;\n        }\n\n        return new Store(store.data);\n    }\n\n    setStore(data, url = null) {\n        // Strip the protocol from the lookup url\n        const key = getKey(url);\n\n        // Get current list of stores\n        const stores = this.get(this.config.keys.stores) || [];\n        let existing = null;\n\n        if (!is.empty(stores)) {\n            // Find existing store by id\n            existing = stores.find(s => s.data.id === data.id);\n        }\n\n        // Extend TTL each\n        const ttl = Date.now() + this.config.ttl;\n\n        // If we found something\n        if (is.object(existing)) {\n            // Update data and extend TTL\n            Object.assign(existing, {\n                data,\n                ttl,\n            });\n\n            if (key !== null) {\n                // Add the URL key for later lookup\n                if (!is.array(existing.urls)) {\n                    existing.urls = [key];\n                } else {\n                    existing.urls.push(key);\n                }\n\n                // Remove duplicate entries\n                const urls = dedupe(existing.urls);\n\n                // Add to existing record\n                Object.assign(existing, {\n                    urls,\n                });\n            }\n        } else {\n            const store = {\n                data,\n                ttl,\n            };\n\n            if (key !== null) {\n                Object.assign(store, {\n                    urls: [key],\n                });\n            }\n\n            stores.push(store);\n        }\n\n        this.set(this.config.keys.stores, stores);\n    }\n}\n\nexport default Storage;\n","import config from './config';\nimport Cart from './models/Cart';\nimport Product from './models/Product';\nimport Store from './models/Store';\nimport http from './utils/http';\nimport is from './utils/is';\nimport Storage from './utils/storage';\n\nclass Client {\n    constructor(props) {\n        const { env, store } = props;\n\n        this.env = !is.empty(env) ? env : '';\n        this.store = store;\n\n        if (!is.url(store) && !is.number(store)) {\n            throw Error('A store ID or URL is required to create a client');\n        }\n\n        this.storage = new Storage();\n    }\n\n    /**\n     * Get the store ID only\n     */\n    getStoreId() {\n        return new Promise((resolve, reject) => {\n            if (is.number(this.store)) {\n                resolve(this.store);\n                return;\n            }\n\n            if (this.store instanceof Store) {\n                resolve(this.store.id);\n                return;\n            }\n\n            // URL is required\n            if (!is.url(this.store)) {\n                reject(new Error('Url is required for user lookup'));\n            }\n\n            // Get by URL\n            this.getStore()\n                .then(store => {\n                    resolve(store.id);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get the Store for current instance\n     */\n    getStore() {\n        return new Promise((resolve, reject) => {\n            // Try from cache by ID or URL\n            if (is.number(this.store) || is.url(this.store)) {\n                const cached = this.storage.getStore(this.store);\n\n                // Return cached if we have it\n                if (cached !== null && cached instanceof Store) {\n                    resolve(cached);\n                    return;\n                }\n            }\n\n            // If already fetched\n            if (this.store instanceof Store) {\n                resolve(this.store);\n                return;\n            }\n\n            // Fetch from remote by ID or URL\n            const url = config.urls.store(this.env, this.store);\n\n            http.get(url)\n                .then(store => {\n                    this.setStore(store);\n                    resolve(this.store);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Set the store details\n     * @param {object} store\n     */\n    setStore(store) {\n        if (!is.object(store)) {\n            return;\n        }\n\n        // Store reference to lookup URL\n        const url = is.url(this.store) ? this.store : null;\n\n        // Map to Store\n        this.store = new Store(store);\n\n        // Add to storage for cache\n        this.storage.setStore(this.store, url);\n    }\n\n    /**\n     * Get product data\n     * @param {string} url - Short or full URL for a product\n     */\n    getProduct(url) {\n        return new Promise((resolve, reject) => {\n            http.get(config.urls.product(this.env, url))\n                .then(json => {\n                    if (!(this.store instanceof Store)) {\n                        this.setStore(json.store);\n                    }\n\n                    resolve(new Product(this, json));\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get all products\n     */\n    getProducts(query = '', page = 1) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    http.get(config.urls.products(this.env, id, query, page < 1 ? 1 : page))\n                        .then(json => {\n                            resolve(json.map(p => new Product(this, p)));\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Create a new shopping cart\n     * @param {string} currency - ISO currency code\n     * @param {string} [discount] - Discount code\n     */\n    createCart(currency, discount) {\n        return new Promise((resolve, reject) => {\n            if (is.empty(currency)) {\n                reject(new Error('currency is required'));\n                return;\n            }\n\n            this.getStoreId()\n                .then(id => {\n                    const currencyCode = currency.toUpperCase();\n\n                    http.post(config.urls.createCart(this.env, id), {\n                        currency: currencyCode,\n                        discount: !is.empty(discount) ? discount : null,\n                    })\n                        .then(json => {\n                            const cart = new Cart(this, json);\n\n                            // Store reference to cart id for later\n                            this.storage.setCart(id, currencyCode, cart);\n\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get a shopping cart or create one if needed\n     * @param {string} currency - The shopping cart ISO currency code\n     */\n    getCartId(currency) {\n        return new Promise((resolve, reject) => {\n            if (!is.currencyCode(currency)) {\n                reject(new Error('A valid currency code is required'));\n                return;\n            }\n\n            this.getStoreId()\n                .then(id => {\n                    const currencyCode = currency.toUpperCase();\n                    const currentCart = this.storage.getCart(id, currencyCode);\n\n                    // Create cart if it doesn't exist\n                    if (is.empty(currentCart)) {\n                        this.createCart(currencyCode)\n                            .then(cart => resolve(cart.id))\n                            .catch(reject);\n                    } else {\n                        resolve(currentCart.id);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get a shopping cart\n     * @param {string} input - The shopping cart ISO currency code or cart ID\n     */\n    getCart(input) {\n        return new Promise((resolve, reject) => {\n            const isCurrency = is.currencyCode(input);\n            const isObjectId = is.objectId(input);\n\n            if (!isCurrency && !isObjectId) {\n                reject(new Error('A valid currency code or cart id are required'));\n                return;\n            }\n\n            if (isCurrency) {\n                const currencyCode = input.toUpperCase();\n\n                this.getCartId(currencyCode)\n                    .then(id => {\n                        if (is.empty(id)) {\n                            reject(new Error(`Could not find matching cart for currency code '${currencyCode}'`));\n                            return;\n                        }\n\n                        this.getCart(id)\n                            .then(cart => {\n                                // Update store\n                                this.setStore(cart.store);\n\n                                resolve(cart);\n                            })\n                            .catch(reject);\n                    })\n                    .catch(reject);\n            } else {\n                http.get(config.urls.getCart(this.env, input))\n                    .then(json => {\n                        const activeId = this.getActiveCart();\n                        const cart = new Cart(this, json, json.id === activeId);\n\n                        // Update store\n                        this.setStore(cart.store);\n\n                        resolve(cart);\n                    })\n                    .catch(reject);\n            }\n        });\n    }\n\n    /**\n     * Get all current carts\n     */\n    getCarts(validate = true) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    const carts = this.storage.getCarts(id);\n\n                    if (is.empty(carts)) {\n                        resolve(null);\n                        return;\n                    }\n\n                    // Check the carts still exist in the server\n                    if (validate) {\n                        const ids = Object.keys(carts).map(currency => carts[currency].id);\n\n                        http.get(config.urls.checkCarts(this.env, ids.join(',')))\n                            .then(json => {\n                                // Remove non existant carts\n                                Object.entries(json).forEach(([cartId, exists]) => {\n                                    if (!exists) {\n                                        const currency = Object.keys(carts).find(c => carts[c].id === cartId);\n                                        delete carts[currency];\n                                    }\n                                });\n\n                                // Store again\n                                this.storage.setCarts(id, carts);\n\n                                // Set active\n                                if (!Object.values(carts).find(cart => cart.active)) {\n                                    this.setActiveCart()\n                                        .then(resolve)\n                                        .catch(reject);\n                                } else {\n                                    resolve(carts);\n                                }\n                            })\n                            .catch(reject);\n                    } else {\n                        resolve(carts);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Set the active cart based on currency\n     * @param {string} input - The shopping cart ISO currency code or cart ID\n     */\n    setActiveCart(input = null) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    this.getCarts(false).then(data => {\n                        const carts = data;\n\n                        // No carts\n                        if (is.empty(carts)) {\n                            resolve(null);\n                            return;\n                        }\n\n                        // Currency code was passed...\n                        if (is.currencyCode(input)) {\n                            const currencyCode = input.toUpperCase();\n                            const currencies = Object.keys(carts);\n\n                            // Bail if not included\n                            if (!currencies.includes(currencyCode)) {\n                                reject(new Error(`No carts for ${currencyCode}`));\n                                return;\n                            }\n\n                            // Set active\n                            currencies.forEach(currency => {\n                                carts[currency].active = currency === currencyCode;\n                            });\n                        } else {\n                            // Set to id if specified, otherwise first\n                            const cartId = is.objectId(input) ? input : carts[Object.keys(carts)[0]].id;\n\n                            // Set active\n                            Object.keys(carts).forEach(currency => {\n                                const cart = carts[currency];\n                                cart.active = cart.id === cartId;\n                            });\n                        }\n\n                        // Store again\n                        this.storage.setCarts(id, carts);\n\n                        resolve(carts);\n                    });\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Get the current active cart\n     */\n    getActiveCart(fetch = false) {\n        return new Promise((resolve, reject) => {\n            this.getStoreId()\n                .then(id => {\n                    const carts = this.storage.getCarts(id);\n\n                    if (!Object.keys(carts).length) {\n                        resolve(null);\n                        return;\n                    }\n\n                    const active = Object.values(carts).find(cart => cart.active);\n\n                    if (!active) {\n                        resolve(null);\n                        return;\n                    }\n\n                    if (!fetch) {\n                        resolve(active.id);\n                        return;\n                    }\n\n                    this.getCart(active.id)\n                        .then(resolve)\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Add a product to a cart\n     * @param {string} id - The cart ID\n     * @param {object} product - The product details\n     */\n    addToCart(id, product) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(product)) {\n                reject(new Error('A valid product is required'));\n                return;\n            }\n\n            http.post(config.urls.addToCart(this.env, id), product)\n                .then(json => {\n                    const cart = new Cart(this, json, true);\n\n                    // Update store\n                    this.setStore(cart.store);\n\n                    // Set the active cart\n                    this.setActiveCart(cart.id)\n                        .then(() => {\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Update an items quantity in the shopping cart\n     * @param {string} id - The shopping cart ID\n     * @param {string} index - The shopping cart item quid\n     * @param {number} quantity - Desired quantity\n     */\n    updateCartItemQuantity(id, index, quantity = 1) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(index)) {\n                reject(new Error('A valid index is required'));\n                return;\n            }\n\n            http.post(config.urls.updateCartItemQuantity(this.env, id), { index, quantity })\n                .then(json => {\n                    const cart = new Cart(this, json, true);\n\n                    // Update store\n                    this.setStore(cart.store);\n\n                    // Set the active cart\n                    this.setActiveCart(cart.id)\n                        .then(() => {\n                            resolve(cart);\n                        })\n                        .catch(reject);\n                })\n                .catch(reject);\n        });\n    }\n\n    /**\n     * Remove a product from a cart\n     * @param {string} id - The shopping cart id\n     * @param {string} index - The shopping cart item guid\n     */\n    removeFromCart(id, index) {\n        return new Promise((resolve, reject) => {\n            if (!is.objectId(id)) {\n                reject(new Error('A valid id is required'));\n                return;\n            }\n\n            if (is.empty(index)) {\n                reject(new Error('A valid index is required'));\n                return;\n            }\n\n            http.post(config.urls.removeFromCart(this.env, id), { index })\n                .then(json => {\n                    // If there's actually a cart left, map it\n                    if (!is.empty(json)) {\n                        const cart = new Cart(this, json, true);\n\n                        // Set the active cart\n                        this.setActiveCart(cart.id)\n                            .then(() => {\n                                resolve(cart);\n                            })\n                            .catch(reject);\n                    } else {\n                        // Otherwise, update carts (as one removed)\n                        this.getCarts()\n                            .then(() => resolve(null))\n                            .catch(reject);\n                    }\n                })\n                .catch(reject);\n        });\n    }\n}\n\nexport default Client;\n"],"names":["getConstructor","input","constructor","instanceOf","Boolean","isArray","Array","isObject","Object","isNumber","Number","isNaN","isString","String","isBoolean","isFunction","Function","isNullOrUndefined","isObjectId","test","isCurrencyCode","isEmpty","length","keys","isUrl","strict","window","URL","string","hostname","e","is","getBase","env","empty","config","url","id","query","page","number","ids","client","ProductUrls","urls","assign","this","ProductImage","image","ProductMedia","media","cover","ProductFile","file","ProductVariant","variant","selected","ProductVariantAttributeOption","label","ProductVariantAttribute","options","map","Product","instance","product","variantId","object","store","array","images","files","variants","variant_attributes","attribute","find","is_featured","quantity_available","CartItem","item","cartId","_quantity","quantity","updateCartItemQuantity","_this","index","_getQuantity","_setQuantity","variant_id","Cart","cart","active","items","from","addToCart","removeFromCart","Store","defaults","Promise","resolve","reject","request","Request","headers","append","then","response","status","error","Error","json","success","errors","data","catch","replaceAll","replace","RegExp","toString","toTitleCase","text","charAt","toUpperCase","substr","toLowerCase","toPascalCase","buildFormData","source","form","namespace","FormData","formKey","forEach","key","babelHelpers.typeof","File","queue","http","includes","fetch","remove","body","dedupe","filter","indexOf","extend","sources","target","shift","parseUrl","storage","Map","getKey","parsed","host","pathname","Storage","Date","getTime","purge","get","root","supported","stored","localStorage","getItem","JSON","parse","value","merge","set","schema","setItem","stringify","stores","ttl","now","removeItem","carts","currency","getCarts","s","existing","push","Client","props","getStore","_this2","cached","setStore","_this3","getStoreId","products","_this4","p","discount","currencyCode","post","createCart","_this5","setCart","currentCart","_this6","getCart","isCurrency","objectId","getCartId","_this7","activeId","getActiveCart","validate","_this8","checkCarts","join","entries","c","setCarts","values","setActiveCart","currencies","_this10","_this11","_this12","_this13"],"mappings":"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"}